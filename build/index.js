!function r(s,a,h){function u(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[e]={exports:{}};s[e][0].call(o.exports,function(t){return u(s[e][1][t]||t)},o,o.exports,r,s,a,h)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],2:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,e,d){var a=/%[sdj%]/g;d.format=function(t){if(!w(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(h(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,o=n.length,r=String(t).replace(a,function(t){if("%%"===t)return"%";if(o<=i)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),s=n[i];i<o;s=n[++i])m(s)||!u(s)?r+=" "+s:r+=" "+h(s);return r},d.deprecate=function(t,e){if(x(global.process))return function(){return d.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var n,o={};function h(t,e){var i={seen:[],stylize:s};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),g(e)?i.showHidden=e:e&&d._extend(i,e),x(i.showHidden)&&(i.showHidden=!1),x(i.depth)&&(i.depth=2),x(i.colors)&&(i.colors=!1),x(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=r),f(i,t,i.depth)}function r(t,e){var i=h.styles[e];return i?"["+h.colors[i][0]+"m"+t+"["+h.colors[i][1]+"m":t}function s(t,e){return t}function f(e,i,n){if(e.customInspect&&i&&R(i.inspect)&&i.inspect!==d.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(n,e);return w(t)||(t=f(e,t,n)),t}var o=function(t,e){if(x(e))return t.stylize("undefined","undefined");if(w(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(b(e))return t.stylize(""+e,"number");if(g(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(e,i);if(o)return o;var r,s=Object.keys(i),a=(r={},s.forEach(function(t,e){r[t]=!0}),r);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),P(i)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return v(i);if(0===s.length){if(R(i)){var h=i.name?": "+i.name:"";return e.stylize("[Function"+h+"]","special")}if(T(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(S(i))return e.stylize(Date.prototype.toString.call(i),"date");if(P(i))return v(i)}var u,l="",p=!1,c=["{","}"];y(i)&&(p=!0,c=["[","]"]),R(i)&&(l=" [Function"+(i.name?": "+i.name:"")+"]");return T(i)&&(l=" "+RegExp.prototype.toString.call(i)),S(i)&&(l=" "+Date.prototype.toUTCString.call(i)),P(i)&&(l=" "+v(i)),0!==s.length||p&&0!=i.length?n<0?T(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),u=p?function(e,i,n,o,t){for(var r=[],s=0,a=i.length;s<a;++s)j(i,String(s))?r.push(_(e,i,n,o,String(s),!0)):r.push("");return t.forEach(function(t){t.match(/^\d+$/)||r.push(_(e,i,n,o,t,!0))}),r}(e,i,n,a,s):s.map(function(t){return _(e,i,n,a,t,p)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(u,l,c)):c[0]+l+c[1]}function v(t){return"["+Error.prototype.toString.call(t)+"]"}function _(t,e,i,n,o,r){var s,a,h;if((h=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),j(n,o)||(s="["+o+"]"),a||(t.seen.indexOf(h.value)<0?-1<(a=m(i)?f(t,h.value,null):f(t,h.value,i-1)).indexOf("\n")&&(a=r?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),x(s)){if(r&&o.match(/^\d+$/))return a;s=(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function y(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function m(t){return null===t}function b(t){return"number"==typeof t}function w(t){return"string"==typeof t}function x(t){return void 0===t}function T(t){return u(t)&&"[object RegExp]"===i(t)}function u(t){return"object"==typeof t&&null!==t}function S(t){return u(t)&&"[object Date]"===i(t)}function P(t){return u(t)&&("[object Error]"===i(t)||t instanceof Error)}function R(t){return"function"==typeof t}function i(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}d.debuglog=function(e){if(x(n)&&(n=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(n)){var i=process.pid;o[e]=function(){var t=d.format.apply(d,arguments);console.error("%s %d: %s",e,i,t)}}else o[e]=function(){};return o[e]},(d.inspect=h).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},h.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},d.isArray=y,d.isBoolean=g,d.isNull=m,d.isNullOrUndefined=function(t){return null==t},d.isNumber=b,d.isString=w,d.isSymbol=function(t){return"symbol"==typeof t},d.isUndefined=x,d.isRegExp=T,d.isObject=u,d.isDate=S,d.isError=P,d.isFunction=R,d.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},d.isBuffer=t("./support/isBuffer");var p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(t,e){return Object.prototype.hasOwnProperty.call(t,e)}d.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),p[t.getMonth()],e].join(" ")),d.format.apply(d,arguments))},d.inherits=t("inherits"),d._extend=function(t,e){if(!e||!u(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,e,i){function n(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=n).prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},n.prototype.setMute=function(t){this.setVolume(null,t)},n.prototype.playLoopSound=function(t,i,n,o,r,s){var a=this.audioManager,h=a.settings.defaultFade,e=a.settings.crossFading,u=this.loopSound,l=u&&u.id;if(i=Math.max(0,Math.min(1,i||1)),this.loopId=t,this.loopVol=i,!a.muted&&!this.muted){if(t===l&&u)return u.play(i*this.volume,n,o),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(u=null,!this.nextLoop||this.nextLoop.id!==t){var p=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=a.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return p.nextLoop.unload(),void(p.nextLoop=null);c(p.loopSound),f()})):(this.nextLoop=a.createSound(t,this.id),c(this.loopSound,f))}}function c(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return a.freeSound(t),t=null,e&&e()})}function d(){var e=p.loopSound=p.nextLoop;p.nextLoop=null,e&&(e.setLoop(!0,r,s),e.fade=h,e.load(function(t){if(t)return e.unload(),void(p.loopSound=null);e.play(i*p.volume,n,o)}))}function f(){p.loopSound=null,window.setTimeout(d,0)}}},{}],5:[function(t,e,i){var n=window.AudioContext||window.webkitAudioContext,o=t("./OrderedList"),r=t("./SoundBuffered.js"),s=t("./SoundGroup.js"),a=t("./AudioChannel.js"),h=t("./ISound.js");function u(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new o(function(){return 1}),this.soundGroupArchive=new o(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new a(i)}h.prototype.audioManager=this,s.prototype.audioManager=this,a.prototype.audioManager=this}n||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),r=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),r=h)),e.exports=u,e.exports.ISound=h,u.prototype.init=function(){if(!this.audioContext&&n)for(var t in this.audioContext=new n,r.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},u.prototype.getEmptySound=function(t,e){var i,n=this.settings.getSoundConstructor(t,e);return n?i=new n:(0<this.freeSoundPool.length?(i=this.freeSoundPool.pop()).init():i=new r,i)},u.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},u.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new a(t))},u.prototype.setVolume=function(t,e,i){var n=this.channels[t];n&&n.setVolume(e,i)},u.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var n=i.muted;i.muted=!0,i.setVolume(null,n)}}},u.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},u.prototype.createSound=function(t,e){var i=this.getSound(t);return i||((i=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),i)},u.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var n=this.settings.getSoundConstructor(e,t)||r;return(i=this.permanentSounds[t]=new n).setId(t),i},u.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},u.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},u.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof r&&this.freeSoundPool.push(t)},u.prototype.playLoopSound=function(t,e,i,n,o,r,s){var a=this.channels[t];if(!a)return console.warn('Channel id "'+t+'" does not exist.');a.playLoopSound(e,i,n,o,r,s)},u.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var n=i.loopSound;i.loopId=null,n&&n.stop(function(){e.freeSound(n),i.loopSound=null})},u.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},u.prototype.release=function(){var t,e,i,n=this.settings.maxSoundGroup,o=this.settings.maxUsedMemory,r={};for(t in this.channels){var s=this.channels[t];s.loopSound&&(r[s.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)r[t]||((i=this.soundsById[t]).poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();n<a&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--a;for(;this.usedMemory>o&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},u.prototype.playSound=function(t,e,i,n,o){if(!this.muted){var r=this.channels[t];if(!r.muted){var s=this.getSound(e);i=i||1,(s=s||this.createSound(e,t)).play(r.volume*i,n,o)}}},u.prototype.playSoundGroup=function(t,e,i,n,o){if(!this.muted){var r=this.channels[t];if(r&&!r.muted){var s=this.getSoundGroup(e);if(!s)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,s.play(i*r.volume,n,o)}}},u.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var n=new s(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=n}},u.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var n in t)this.createSoundGroup(n,t[n],i)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,e,i){function n(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=n).prototype.setId=function(t){this.id=t,this._loaded=!1},n.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},n.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},n.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},n.prototype.play=function(t,e,i){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(i):this._play(i)},n.prototype.init=function(){},n.prototype.setVolume=function(t){this.volume=t},n.prototype.setPan=function(t){this.pan=t},n.prototype.setLoop=function(t){this.loop=t},n.prototype.setPitch=function(t){this.pitch=t},n.prototype._updatePlayPitch=function(t){},n.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},n.prototype.stop=function(t){return this.playing=!1,t&&t()},n.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},n.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,e,i){function r(t,e,i,n){this.object=t,this.previous=e,this.next=i,this.container=n}function n(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}n.prototype.add=function(t){var e=new r(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var n,o=this.cmpFunc(t,this.last.object);if(0<=o)return e.previous=this.last,this.last.next=e,this.last=e;if(i+o<0){for(n=this.first.next;0<=this.cmpFunc(t,n.object);)n=n.next;e.next=n,e.previous=n.previous,e.previous.next=e,n.previous=e}else{for(n=this.last.previous;this.cmpFunc(t,n.object)<0;)n=n.previous;e.previous=n,e.next=n.next,e.next.previous=e,n.next=e}return e},n.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},n.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},n.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},n.prototype.possess=function(t){return t&&t.container===this},n.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},n.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},n.prototype.getFirst=function(){return this.first&&this.first.object},n.prototype.getLast=function(){return this.last&&this.last.object},n.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},n.prototype.getCount=function(){return this.count},n.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},n.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},n.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,n=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(n,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(n,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=n},{}],8:[function(t,e,i){var n=t("util").inherits,o=t("./ISound.js"),r={playAudioWhenScreenIsLocked:!1};function s(){o.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}n(s,o),(e.exports=s).prototype.setVolume=function(t){this.volume=this._audio.volume=t},s.prototype.setLoop=function(t){this.loop=this._audio.loop=t},s.prototype._load=function(){var e=this;function i(t){e._finalizeLoad(t)}function n(){this.removeEventListener("canplaythrough",n),this.removeEventListener("error",o),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function o(t){this.removeEventListener("canplaythrough",n),this.removeEventListener("error",o),i(t)}function r(t){e._loading=!0,e._audio.addEventListener("canplaythrough",n),e._audio.addEventListener("error",o),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,s=this.audioManager.settings.audioPath;if(2<t.length)t(s,this.id,function(t,e){if(t)return i(t);r(e)});else try{var a=t(s,this.id);if(!a)return i("emptyUri");r(a)}catch(t){i(t)}},s.prototype.unload=function(){o.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},s.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(r),this.playing=!0},s.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,e,i){var n=t("util").inherits,o=t("./ISound.js"),r=1e-6;function s(){o.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}n(s,o),(e.exports=s).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},s.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},s.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,i=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<i)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},s.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=r);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},s.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},s.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},s.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},s.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},s.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},s.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||r,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}else this.source.playbackRate.value=e}},s.prototype._load=function(){var i=this;function n(t){i._finalizeLoad(t)}function o(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i._finalizeLoad(null)}function r(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?n("xhrError:"+e.status):void(i.audioContext?i.audioContext.decodeAudioData(e.response,o,n):(i.rawAudioData=e.response,i._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return n(t);r(e)});else try{var s=t(e,this.id);if(!s)return n("emptyUri");r(s)}catch(t){n(t)}},s.prototype.unload=function(){o.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},s.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||r,e),this.gain.linearRampToValueAtTime(this.volume||r,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var n=this;i.onended=function(){n.playing=!1,i.onended=null,n.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)}else this._playTriggered=Date.now()},s.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},s.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||r,i),this.gain.linearRampToValueAtTime(r,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,e,i){function n(t,e,i,n,o){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=n||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),o||this._createSounds()}(e.exports=n).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},n.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var n=this.soundIds[this.soundIndex++],o=this.audioManager.getSound(n);if(!o)return console.warn("[Sound Group: "+this.id+"] sound id "+n+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],o.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},n.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],11:[function(t,e,i){var s=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function n(){this.R=0,this.G=0,this.B=0,this.r=0,this.g=0,this.b=0,this.string=""}(e.exports=n).prototype._setRGB=function(t,e,i){this.R=t,this.G=e,this.B=i,this.r=t/255,this.g=e/255,this.b=i/255},n.prototype.fromPixel=function(t,e){var i=t[e+0],n=t[e+1],o=t[e+2];return this.string="rgb("+i+","+n+","+o+")",this._setRGB(i,n,o),this},n.prototype.fromString=function(t){var e,i,n,o=(this.string=t).match(s);if(o)e=~~o[1],i=~~o[2],n=~~o[3],this._setRGB(e,i,n);else{var r="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(r>>16,r>>8&255,255&r)}return this},n.prototype.fromRGB=function(t,e,i){return this._setRGB(t,e,i),this.string="rgb("+t+","+e+","+i+")",this},n.prototype.fromColorRGB=function(t){return this.R=t.R,this.G=t.G,this.B=t.B,this.r=t.r,this.g=t.g,this.b=t.b,this.string=t.string,this}},{}],12:[function(t,e,i){var n=t("./index"),o=t("../domUtils/createCanvas"),u=~~settings.tileSize.width,l=~~settings.tileSize.height,v=Math.PI/2;n.setTileSize=function(t,e){u=~~t,l=~~e},n.prototype._init=function(){this.canvas=o(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},n.prototype.resize=function(t,e){return this.canvas.width=this.width=t,this.canvas.height=this.height=e,this.clear(),this},n.prototype.sprite=function(t,e,i,n,o,r){var s=u*(t%16),a=l*~~(t/16),h=this.ctx;return e=e||0,i=i||0,e=~~Math.round(e-this.camera.x),i=~~Math.round(i-this.camera.y),n||o||r?(h.save(),n&&(h.scale(-1,1),e=-e-u),o&&(h.scale(1,-1),i=-i-l),r?(h.translate(e+l,i),h.rotate(v)):h.translate(e,i),h.drawImage(this.tilesheet,this.ox+s,this.oy+a,u,l,0,0,u,l),h.restore()):h.drawImage(this.tilesheet,this.ox+s,this.oy+a,u,l,e,i,u,l),this},n.prototype.draw=function(t,e,i,n,o,r){var s=n||o||r;if(t._isSprite){var a=t;t=a.img;var h=a.x,u=a.y,l=a.width,p=a.height,c=~~Math.round((e||0)-this.camera.x),d=~~Math.round((i||0)-this.camera.y);return s?((f=this.ctx).save(),r?(n&&(f.scale(-1,1),c*=-1,c-=p),o&&(f.scale(1,-1),d*=-1,d-=l),f.translate(c+p,d),f.rotate(v)):(n&&(f.scale(-1,1),c*=-1,c-=l),o&&(f.scale(1,-1),d*=-1,d-=p),f.translate(c,d)),f.drawImage(t,h,u,l,p,0,0,l,p),f.restore(),this):(this.ctx.drawImage(t,h,u,l,p,c,d,l,p),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var f;c=~~Math.round((e||0)-this.camera.x),d=~~Math.round((i||0)-this.camera.y);return s?((f=this.ctx).save(),r?(n&&(f.scale(-1,1),c*=-1,c-=t.height),o&&(f.scale(1,-1),d*=-1,d-=t.width),f.translate(c+t.height,d),f.rotate(v)):(n&&(f.scale(-1,1),c*=-1,c-=t.width),o&&(f.scale(1,-1),d*=-1,d-=t.height),f.translate(c,d)),f.drawImage(t,0,0),f.restore()):this.ctx.drawImage(t,c,d),this},n.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},n.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},n.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},n.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},n.prototype.rect=function(t,e,i,n){return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(e-this.camera.y),~~(i-1),~~(n-1)),this},n.prototype.rectf=function(t,e,i,n){return this.ctx.fillRect(~~(t-this.camera.x),~~(e-this.camera.y),~~i,~~n),this},n.prototype.rectfill=n.prototype.rectf,n.prototype._isTexture=!0,n.prototype.tilesheet=o(16*u,16*l)},{"../domUtils/createCanvas":17,"./index":13}],13:[function(t,e,i){function n(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function o(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=n).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],n.prototype.ox=0,n.prototype.oy=0,n.prototype.setPalette=function(t){n.prototype.palette=t},n.prototype.setGlobalTilesheet=function(t){o(n.prototype,t)},n.prototype.setTilesheet=function(t){if(t)return o(this,t),this;delete this.tilesheet},n.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],14:[function(t,e,i){var n=t("./index.js"),u=3,l=5,o=n.prototype.setPalette;n.prototype.setPalette=function(t){o.call(this,t),n.prototype.textCharset=new n(128*u,l*t.length),function(t,e){for(var i=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],n=0;n<e.length;n++){t.fillStyle=e[n].string;for(var o=0;o<i.length;o++)for(var r=i[o],s=0;s<15;s++){var a=s%u,h=~~(s/u);1==(r>>s&1)&&t.fillRect(o*u+a,n*l+h,1,1)}}t.fillStyle=e[0].string}(n.prototype.textCharset.ctx,t)};var r=n.prototype.resize;n.prototype.resize=function(t,e){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(e/6),this._textPadding=e-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,r.call(this,t,e),this},n.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},n.prototype.textCharset=new n(128*u,l*n.prototype.palette.length),n.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},n.prototype.print=function(e,t,i){if("object"==typeof e)try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),i=~~Math.round(i-this.camera.y);for(var n=0;n<e.length;n++)this.ctx.drawImage(this.textCharset.canvas,u*e.charCodeAt(n),l*this._pen,u,l,t,i,u,l),t+=4;return this}for(n=0;n<e.length;n++){this._cursor.j>=this._textLine&&this.textScroll();var o=e.charCodeAt(n);10!==o&&13!==o?(this.ctx.drawImage(this.textCharset.canvas,u*o,l*this._pen,u,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,u,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},n.prototype.println=function(t){return this.print(t),this.print("\n"),this},n.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":13}],15:[function(t,e,i){var n=t("../Texture"),u=~~settings.tileSize.width,l=~~settings.tileSize.height;function p(t,e,i,n,o,r,s,a){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!n,this.flipV=!!o,this.flipR=!!r,this.flagA=!!s,this.flagB=!!a}function r(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=r).prototype._isTileMap=!0;var a,d,o={},s=[];r.getMap=function(t){return"string"==typeof t?o[t]:"number"==typeof t?s[t]:(console.error("Map does not exist",t),null)},r._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:(console.warn("No map bank"),{_type:"maps",maps:[]})},r.loadBank=function(t){t=r._checkBankFormat(t),o={},s=[];for(var e=t.maps||[],i=0;i<e.length;i++)s.push((new r).load(e[i]))},r.setTileSize=function(t,e){u=~~t,l=~~e},Object.defineProperty(r.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&o[this._name]&&o[this._name]===this&&delete o[this._name],(this._name=t)&&!o[t]&&(o[t]=this)}}),r.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var n=0;n<e;n++)this.items[i][n]=null}this.texture&&this.texture.resize(t*u,e*l)},r.prototype.resize=function(t,e){var i=this.items,n=Math.min(this.width,t),o=Math.min(this.height,e);this._init(t,e);for(var r=0;r<n;r++)for(var s=0;s<o;s++)this.items[r][s]=i[r][s];return this.redraw(),this},r.prototype.set=function(t,e,i,n,o,r,s,a){if(null==i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var h=this.items[t][e]=new p(t,e,i,n,o,r,s,a);return this.texture&&(this.texture.ctx.clearRect(t*u,e*l,u,l),this.texture.sprite(h.sprite,h.x*u,h.y*l,h.flipH,h.flipV,h.flipR)),this}},r.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*u,e*l,u,l),this},r.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},r.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i=this.items[t][e];i&&this.texture.sprite(i.sprite,i.x*u,i.y*l,i.flipH,i.flipV,i.flipR)}return this},r.prototype._prepareTexture=function(){this.texture=new n(this.width*u,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},r.prototype.release=function(){this.texture=null},r.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},r.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&this.texture.setTilesheet(t),this.redraw(),this},r.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),i=window.assets||{},n=0;n<e.length;n++)if(!(i=i[e[n]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(i)},function(){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",u={},t=0;t<i.length;t++)u[i[t]]=t;var l=i.length,p=l*l-1,c=Math.pow(2,13),r=p-c-1;function s(t){var e=t%l;return i[~~(t/l)]+i[e]}a=function(t){for(var e="",i=0,n=0;n<t.length;n++){var o=t[n];o===t[n+1]&&++i<r||(null===o&&(o=p),e+=s(o),i===r&&i--,0!==i&&(e+=s(c+i)),i=0)}return i===r&&i--,0!==i&&(e+=s(c+i)),e},d=function(t){for(var e=[],i=0;i<t.length;){var n=t[i++],o=t[i++],r=u[n]*l+u[o];if(r===p)e.push(null);else if(c<r)for(var s=r-c,a=e[e.length-1],h=0;h<s;h++)e.push(a);else e.push(r)}return e}}(),r.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),n=0;n<t;n++)for(var o=0;o<e;o++){var r=this.items[n][o];i[n+o*t]=r?r.sprite+(r.flipH<<8)+(r.flipV<<9)+(r.flipR<<10)+(r.flagA<<11)+(r.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(i)}},r.prototype.load=function(t){this.texture=null;var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var n=d(t.data),o=0;o<e;o++)for(var r=0;r<i;r++){var s=n[o+r*e];if(null!==s){var a=255&s,h=s>>8&1,u=s>>9&1,l=s>>10&1,p=s>>11&1,c=s>>12&1;this.set(o,r,a,h,u,l,p,c)}}return this},r.prototype.copy=function(t,e,i,n){t=t||0,e=e||0,null==i&&(i=this.width),null==n&&(n=this.height);var o=new r(i,n);return o.paste(this,-t,-e),o},r.prototype.paste=function(t,e,i,n){e=e||0,i=i||0;for(var o=Math.min(t.width,this.width-e),r=Math.min(t.height,this.height-i),s=Math.max(0,-e),a=Math.max(0,-i),h=s;h<o;h++)for(var u=a;u<r;u++){var l=t.items[h][u];if(l)this.set(h+e,u+i,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(n)continue;this.remove(h+e,u+i)}}return this},r.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},r.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var n=[],o=0;o<this.width;o++)for(var r=0;r<this.height;r++){var s=this.items[o][r];if(s){var a=null===e||s.flagA===e,h=null===i||s.flagB===i;s.sprite===t&&a&&h&&n.push(s)}}return n},r.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"../Texture":13}],16:[function(t,e,i){function d(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function f(t,e){var i=new Audio;function n(){e&&e(null,i),i.removeEventListener("canplaythrough",n),i.removeEventListener("error",o)}function o(){e&&e("snd:load"),i.removeEventListener("canplaythrough",n),i.removeEventListener("error",o)}i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",n),i.addEventListener("error",o),i.src=t,i.load()}i.loadData=function(t,e,i){var n=new XMLHttpRequest;n.responseType=e||"arraybuffer",n.onreadystatechange=function(){if(4==~~n.readyState)return 200!=~~n.status&&0!=~~n.status?i&&i("xhrError:"+n.status):i&&i(null,n.response)},n.open("GET",t,!0),n.send()},i.loadJson=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()},i.sendRequest=function(t,e){var i=new XMLHttpRequest;i.open("POST","req",!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.onreadystatechange=function(){if(4==~~i.readyState){if(200!=~~i.status)return e&&e("xhr:"+i.status);var t=JSON.parse(i.response);return e&&e(t.error,t.result)}},i.send(JSON.stringify(t))},i.loadImage=d,i.loadSound=f,i.preloadStaticAssets=function(n,o,r){var a=n.dat,s=n.img.length,h=s+n.snd.length,u=n.root,l=0,p=0;function c(){var i,t,e=l+p;r&&r(l,e,h,e/h),t=e<s?(i=n.img[e],d):(i=n.snd[e-s],f),p+=1,t(u+i,function(t,e){t||function(t,e){var i=t.split("/"),n=i.pop().split(".");n.pop(),n=n.join(".");for(var o=a,r=0,s=i.length;r<s;r++)o=o[i[r]];o[n]=e,i.push(n),e.name=n,e.path=i.join("/")}(i,e),(l+=1)+--p<h?c():0===p&&o(null,a)})}if(0===h)return o(null,a);for(var t=Math.min(5,h-1),e=0;e<=t;e++)c()}},{}],17:[function(t,e,i){e.exports=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{}],18:[function(t,e,i){var p=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],n=!(!navigator||!navigator.getGamepads),c=!1,d=.2;function o(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}o.prototype._setupButtons=function(){for(var t=0;t<p.length;t++){var e=p[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var f=[new o,new o,new o,new o,window],r=new o;var s=n?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],n=f[e];if(i){var o,r,s,a;n.available=!0,c&&(o=n.btn.right,r=n.btn.left,a=n.btn.down,s=n.btn.up);for(var h=0;h<p.length;h++){var u=p[h],l=i.buttons[h].pressed;n.btnp[u]=!n.btn[u]&&l,n.btnr[u]=n.btn[u]&&!l,n.btn[u]=l}n.x=i.axes[0],n.y=i.axes[1],n.z=i.axes[2],n.w=i.axes[3],n.lt=i.buttons[6].value,n.rt=i.buttons[7].value,c&&(n.btn.right=n.btn.right||n.x>d,n.btn.left=n.btn.left||n.x<-d,n.btn.down=n.btn.down||n.y>d,n.btn.up=n.btn.up||n.y<-d,n.btnp.right=n.btn.right&&!o,n.btnp.left=n.btn.left&&!r,n.btnp.down=n.btn.down&&!a,n.btnp.up=n.btn.up&&!s,n.btnr.right=!n.btn.right&&o,n.btnr.left=!n.btn.left&&r,n.btnr.down=!n.btn.down&&a,n.btnr.up=!n.btn.up&&s)}else n.available=!1}return f}:function(){return f};i.mapAnalogStickToDpad=function(t){c=!0,d=void 0===t?.3:t},i.update=function(){window.gamepads=s(),window.gamepad=function(){for(var t=0;t<p.length;t++){var e=p[t];r.btnp[e]=btnp[e]||f[0].btnp[e]||f[1].btnp[e]||f[2].btnp[e]||f[3].btnp[e],r.btnr[e]=btnr[e]||f[0].btnr[e]||f[1].btnr[e]||f[2].btnr[e]||f[3].btnr[e],r.btn[e]=btn[e]||f[0].btn[e]||f[1].btn[e]||f[2].btn[e]||f[3].btn[e]}return r.btn.up&&r.btn.down&&(r.btn.down=!1),r.btn.right&&r.btn.left&&(r.btn.left=!1),r}()}},{}],19:[function(t,e,i){e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],20:[function(t,e,i){var n=window.settings,a=~~n.screen.pixelSize.width,h=~~n.screen.pixelSize.height,o=!0,r=$screen.canvas,u=0,l=0,p=r,c=r;if(n.screen.fullscreen){var s=n.screen.width,d=n.screen.height,f=null;function v(){f=null;var t=r.getBoundingClientRect();a=t.width/s,h=t.height/d}window.onresize=function(){f&&window.clearTimeout(f),f=window.setTimeout(v,300)},v()}var _={start:{mouseEvent:null,mouseId:"mousedown",touchEvent:null,touchId:"touchstart"},end:{mouseEvent:null,mouseId:"mouseup",touchEvent:null,touchId:"touchend"},move:{mouseEvent:null,mouseId:"mousemove",touchEvent:null,touchId:"touchmove"}};function y(t,s){var e=_[t];o&&(e.mouseEvent&&p.removeEventListener(e.mouseId,e.mouseEvent),e.touchEvent&&c.removeEventListener(e.touchId,e.touchEvent)),e.mouseEvent=function(t){t.preventDefault();var e=t.layerX/a,i=t.layerY/h;s(e,i,0,t)},e.touchEvent=function(t){t.preventDefault();for(var e=t.changedTouches,i=0;i<e.length;i++){var n=e[i],o=(n.clientX-u)/a,r=(n.clientY-l)/h;s(o,r,n.identifier,n)}},o&&(p.addEventListener(e.mouseId,e.mouseEvent),c.addEventListener(e.touchId,e.touchEvent))}!function(t){var e=(r=t||r||$screen.canvas).getBoundingClientRect();u=e.left,l=e.top;var i=n.touchEvent||{};i.disableContextMenu&&(r.oncontextmenu=function(){return!1}),i.hideMousePointer&&(r.style.cursor="none"),i.multiTouch&&0,c=r}(),i.enable=function(t){o!==(t=!!t)&&((o=t)?(event.mouseEvent&&p.addEventListener(event.mouseId,event.mouseEvent),event.touchEvent&&c.addEventListener(event.touchId,event.touchEvent)):(event.mouseEvent&&p.removeEventListener(event.mouseId,event.mouseEvent),event.touchEvent&&c.removeEventListener(event.touchId,event.touchEvent)))},i.onPress=function(t){y("start",t)},i.onRelease=function(t){y("end",t)},i.onMove=function(t){y("move",t)},i.onEnter=function(t){},i.onExit=function(t){}},{}],21:[function(t,e,i){e.exports={dat:{halo:null,lightMask:null,tilesheet:null,maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"",data:"~?#b|71(#Q#R!!|7#a1(#R!!|3#/!!|~#P#R!!|~#?!!|3#P#R!!|-#@#~#B!!|2#P#R!!|-#a1(~/#2!!|-#?!!|-#a#R!!|~#a#c!!|~#P#B!!|-#R!!|4#P#c!!|-#R!!|4#`!!|~#R!!|,#?!!|6#>#B!!#`!!|,#@#B!!|-##!!|-#@#Q#R!!|~#P~/#2!!|-##!!|,#P~?#c!!|-#0#b#c!!|1#P#R!!|8#P#R!!|2#@#A###A|-6W#R!!|/#@#A|,6W#Q|0"},{w:16,h:16,name:"background",sheet:"",data:"#,|;#=#-|,#=|0#-#=|-#,#=#,#-#=|,#-|,#=#-|,#=#M#=|-#-#=#,#=|~#,#=|,#-#=|-#-|,#=|,#,#-#=|,#,|-#=|~#-|-#=|,#,#-#=|,#,|~#=|,#-#,#=#-#=|,#,#=#M#=#-#,|,#=|-#-#,|,#=|-#,#=|,#-|~#=|,~~#=#,|,#=|-#,#=|,#-|,#=|~~~#=#,#=|,~~#=#,#=|,#,#=|-#-|-#=#-#=#M#L#=#,|,#=#,#=#-#,|,#-|,#=|,#-#N#-#=#,|,#=#-#=#-#,|-#=#M#-#,#=|,#,|-#-#=|,#,|-#-#=#-|-#=|,#,|,#-|,#=|,#-|-#=|~#-#=|,#,|,#=|,#M~~|,#=|-#,|2#=|-~~|,#,|4"},{w:16,h:16,name:"test",sheet:"",data:"##|-!!|-##|~!!|-##|0!!##!!##|~!!##!!##|0!!|-##|~!!|-##|=!!|-##|4!!|~##!!##|,!!|0##|,!!##!!|~##|,!!|0##|,!!|-##|/!!|,##|,!!|,##|4!!|,##|,!!|,##|/!!|-##|,!!|0##|,!!|~##!!##|,!!|0##|,!!##!!|~##|4!!|-##|=!!|-##|/!!|-##|/!!##!!##|/!!##!!##|/!!|-##|/!!|-##|,"}]}},root:"assets/",img:["halo.png","lightMask.png","tilesheet.png"],snd:[],settings:{name:"lightcast",version:"2.0.0",screen:{width:128,height:128,pixelSize:{width:4,height:4},fullscreen:!1},tileSize:{width:8,height:8},palette:{name:"pico8",colors:["#000000","#FFF1E8","#008751","#AB5236","#7E2553","#5F574F","#29ADFF","#00E756","#FFA300","#FF77A8","#C2C3C7","#83769C","#FFFF27","#FFCCAA","#1D2B53","#FF004D"]},controls:{up:38,down:40,left:37,right:39,A:32,B:88},gamepad:{analogToDpad:!0,deadZone:.5},touchEvent:{multiTouch:!1,disableContextMenu:!1,hideMousePointer:!1},loader:{colors:["#000","#FFF"],custom:""},appid:"xl3WcqXNVmwLe2rE"}}},{}],22:[function(t,e,i){var a=t("./Transition"),h=t("./TransitionRelative"),u=t("./easing"),o=t("./interpolation");function n(t,e,i,n){this.start=t,this.end=t+e,this.duration=e,this.properties=n,this.to=i}function r(t,e){if(this._object=t,null==e&&t instanceof Array){e=[];for(var i=0;i<t.length;i+=1)e[i]=i}this._properties=e,this._from=null,this._interpolations=null,this._index=0,this._transitions=[],this._relative=!1,this._time=0,this._duration=0}n.prototype.update=function(t){for(var e=0;e<this.properties.length;e+=1){var i=this.properties[e];t[i]=this.to[i]}},(e.exports=r).prototype.relative=function(t){return this._relative=t,this},r.prototype.reset=function(){return this._index=0,this._duration=0,this._transitions=[],this},r.prototype.interpolations=function(t){for(var e=0;e<this._properties.length;e+=1){var i=this._properties[e],n=t[i];void 0!==n?"string"==typeof n&&(void 0===o[n]?(console.warn("[AbstractTween.interpolations] Given interpolation does not exist"),t[i]=o.linear):t[i]=o[n]):t[i]=o.linear}return this._interpolations=t,this},r.prototype.from=function(t){return this._from=t,0<this._transitions.length&&(this._transitions[0].from=t),this},r.prototype._setFrom=function(){this._from={};for(var t=0;t<this._properties.length;t+=1){var e=this._properties[t];this._from[e]=!0===this._relative?0:this._object[e]}return this._from},r.prototype._getLastTransitionEnding=function(){return 0<this._transitions.length?!0===this._relative?this._setFrom():this._transitions[this._transitions.length-1].to:null===this._from?this._setFrom():this._from},r.prototype.to=function(t,e,i,n,o){"string"==typeof i&&(i=void 0===u[i]?void console.warn("[AbstractTween.to] Given easing does not exist"):u[i]);var r=this._getLastTransitionEnding(),s=new(!0===this._relative?h:a)(this._properties,r,t,this._duration,e,i,n,this._interpolations,o);return this._transitions.push(s),this._duration+=e,this},r.prototype.wait=function(t){var e=this._getLastTransitionEnding();return this._transitions.push(new n(this._duration,t,e,this._properties)),this._duration+=t,this},r.prototype._update=function(){for(var t=this._transitions[this._index];t.end<=this._time;){if(this._index===this._transitions.length-1)return void t.update(this._object,1);!0===this._relative&&t.update(this._object,1),t=this._transitions[++this._index]}for(;this._time<=t.start;){if(0===this._index)return void t.update(this._object,0);!0===this._relative&&t.update(this._object,0),t=this._transitions[--this._index]}t.update(this._object,(this._time-t.start)/t.duration)},r.prototype._validate=function(){return 0!==this._transitions.length||(console.warn("[AbstractTween._validate] Cannot start a tween with no transition:",this),!1)}},{"./Transition":37,"./TransitionRelative":38,"./easing":41,"./interpolation":44}],23:[function(t,e,i){function n(){this._duration=0,this._onComplete=null,this._iterations=1,this._pingpong=!1,this._persist=!1}(e.exports=n).prototype.setSpeed=function(t){0===t?0!==this._speed&&(this._startTime+=this._time/this._speed-this._time):0===this._speed?this._startTime+=this._time-this._time/t:this._startTime+=this._time/this._speed-this._time/t,this._speed=t,null!==this._player&&this._player._onPlayableChanged(this)},n.prototype.onComplete=function(t){return this._onComplete=t,this},n.prototype.getDuration=function(){return this._duration*this._iterations/this._speed},n.prototype._setDuration=function(t){this._duration=t,null!==this._player&&this._player._onPlayableChanged(this)},n.prototype._extendDuration=function(t){this._duration+=t,null!==this._player&&this._player._onPlayableChanged(this)},n.prototype._getEndTime=function(){return 0<this._speed?this._startTime+this.getDuration():this._speed<0?this._startTime:1/0},n.prototype._setStartTime=function(t){0<this._speed?this._startTime=t:this._speed<0?this._startTime=t-this.getDuration():this._startTime=1/0},n.prototype._getStartTime=function(){return 0<this._speed?this._startTime:this._speed<0?this._startTime+this.getDuration():-1/0},n.prototype._isTimeWithin=function(t){return 0<this._speed?this._startTime<t&&t<this._startTime+this.getDuration():!(this._speed<0)||this._startTime+this.getDuration()<t&&t<this._startTime},n.prototype._overlaps=function(t,e){return 0<this._speed?(this._startTime-e)*(this._startTime+this.getDuration()-t)<=0:!(this._speed<0)||(this._startTime+this.getDuration()-e)*(this._startTime-t)<=0},n.prototype.goToEnd=function(){return this.goTo(this.getDuration(),this._iterations-1)},n.prototype.loop=function(){return this.iterations(1/0)},n.prototype.iterations=function(t){return t<0?console.warn("[BriefExtension.iterations] Number of iterations cannot be negative"):(this._iterations=t,null!==this._player&&this._player._onPlayableChanged(this)),this},n.prototype.persist=function(t){return this._persist=t,this},n.prototype.pingpong=function(t){return this._pingpong=t,null!==this._player&&this._player._onPlayableChanged(this),this},n.prototype._complete=function(t){return!0===this._persist?(this._startTime+=t,void this._player._onPlayableChanged(this)):!1===this._player._inactivate(this)?this:void(null!==this._onComplete&&this._onComplete(t))};n.prototype._moveTo=function(t,e,i){var n;if(0!==(e*=this._speed))if(1===this._iterations)this._time=(t-this._startTime)*this._speed,0<e?this._time>=this._duration?(n=this._time-this._duration,this._time=this._duration):this._time:e<0&&this._time<=0&&(n=this._time,this._time=0);else{var o=(t=(t-this._startTime)*this._speed)/this._duration;0<e?0<o&&o<this._iterations?this._time=t%this._duration:(n=(o-this._iterations)*this._duration,this._time=this._duration*(1-(Math.ceil(this._iterations)-this._iterations))):e<0&&(0<o&&o<this._iterations?this._time=t%this._duration:(n=o*this._duration,this._time=0)),!0===this._pingpong&&(void 0===n?0==(1&Math.ceil(o))&&(this._time=this._duration-this._time):Math.ceil(this._iterations)===this._iterations&&0==(1&Math.ceil(this._iterations))&&(this._time=this._duration-this._time))}void 0!==i&&void 0===n&&(0<e&&this.duration-this._time<1e-6?(n=i,this._time=this._duration):e<0&&this._time<1e-6&&(n=i,this._time=0)),this._update(e,n),null!==this._onUpdate&&(void 0===n?this._onUpdate(this._time,e):this._onUpdate(this._time,e-n)),void 0!==n&&this._complete(n)}},{}],24:[function(t,e,i){var n=t("./inherit"),o=t("./Playable"),r=t("./BriefExtension");function s(){o.call(this),r.call(this)}n((s.prototype=Object.create(o.prototype)).constructor=s,r),e.exports=s},{"./BriefExtension":23,"./Playable":29,"./inherit":43}],25:[function(t,e,i){var n=t("./inherit"),o=t("./Player"),r=t("./BriefExtension");function s(){o.call(this),r.call(this)}n((s.prototype=Object.create(o.prototype)).constructor=s,r),(e.exports=s).prototype._onAllPlayablesRemoved=function(){this._duration=0},s.prototype._onPlayableChanged=s.prototype._updateDuration=function(){var t,e,i,n=0;for(t=this._activePlayables.first;null!==t;t=t.next)n<(i=(e=t.object)._getStartTime()+e.getDuration())&&(n=i);for(t=this._inactivePlayables.first;null!==t;t=t.next)n<(i=(e=t.object)._getStartTime()+e.getDuration())&&(n=i);this._setDuration(n)},s.prototype._onPlayableRemoved=s.prototype._updateDuration},{"./BriefExtension":23,"./Player":30,"./inherit":43}],26:[function(t,e,i){var n=t("./BriefPlayable");function o(t){if(this instanceof o==!1)return new o(t);n.call(this),this._duration=t}(o.prototype=Object.create(n.prototype)).constructor=o,e.exports=o},{"./BriefPlayable":24}],27:[function(t,e,i){function n(t,e,i,n){this.object=t,this.previous=e,this.next=i,this.container=n}function o(){this.first=null,this.last=null,this.length=0}(e.exports=o).prototype.add=o.prototype.addFront=function(t){var e=new n(t,null,this.first,this);return null===this.first?(this.first=e,this.last=e):(this.first.previous=e,this.first=e),this.length+=1,e},o.prototype.addBack=function(t){var e=new n(t,this.last,null,this);return null===this.first?this.first=e:this.last.next=e,this.last=e,this.length+=1,e},o.prototype.pop=o.prototype.popFront=function(t){var e=this.first.object;return this.removeByReference(this.first),e},o.prototype.popBack=function(t){var e=this.last.object;return this.removeByReference(this.last),e},o.prototype.addBefore=function(t,e){var i=new n(e,t.previous,t,this);return null!==t.previous&&(t.previous.next=i),t.previous=i,this.first===t&&(this.first=i),this.length+=1,i},o.prototype.addAfter=function(t,e){var i=new n(e,t,t.next,this);return null!==t.next&&(t.next.previous=i),t.next=i,this.last===t&&(this.last=i),this.length+=1,i},o.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},o.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},o.prototype.removeByReference=function(t){return t.container!==this?(console.warn("[DoublyList.removeByReference] Trying to remove a node that does not belong to the list"),t):(null===t.next?this.last=t.previous:t.next.previous=t.previous,null===t.previous?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=null,t.container=null,--this.length,null)},o.prototype.remove=function(t){for(var e=this.first;null!==e;e=e.next)if(e.object===t)return this.removeByReference(e),!0;return!1},o.prototype.getNode=function(t){for(var e=this.first;null!==e;e=e.next)if(e.object===t)return e;return null},o.prototype.clear=function(){for(var t=this.first;null!==t;t=t.next)t.container=null;this.first=null,this.last=null,this.length=0},o.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},o.prototype.toArray=function(){for(var t=[],e=this.first;null!==e;e=e.next)t.push(e.object);return t}},{}],28:[function(t,e,i){var v=t("./BriefPlayable"),_=t("./AbstractTween");function y(t,e){if(this instanceof y==!1)return new y(t,e);v.call(this),this._tweensPerObject={},this._tweens=[],this._propertyChains={},this._propertyChainStrings=[];for(var i,n,o={},r={},s=0;s<e.length;s+=1){var a=e[s];if(void 0===r[n=a.substring(0,a.lastIndexOf("."))]){for(var h=a.split("."),u=h.length-1,l=t,p=0;p<u;p+=1)l=l[h[p]];l[i=h[u]]instanceof Array?(r[a]=null,o[a]=l[i],this._propertyChainStrings.push(a),this._propertyChains[a]=h):(r[n]=[i],o[n]=l,this._propertyChainStrings.push(n),h.pop(),this._propertyChains[n]=h)}else i=a.substring(a.lastIndexOf(".")+1),r[n].push(i)}for(n in o){var c=o[n],d=r[n],f=new _(c,d);this._tweens.push(f),this._tweensPerObject[n]=f}}(y.prototype=Object.create(v.prototype)).constructor=y,(e.exports=y).prototype.relative=function(t){for(var e=0;e<this._tweens.length;e+=1)this._tweens[e].relative(t);return this},y.prototype.reset=function(){for(var t=0;t<this._tweens.length;t+=1)this._tweens[t].reset();return this._duration=0,this},y.prototype.interpolations=function(t){for(var e=0;e<this._propertyChainStrings.length;e+=1){for(var i=this._propertyChainStrings[e],n=this._propertyChains[i],o=n.length,r=t,s=0;s<o&&void 0!==r;s+=1)r=r[n[s]];void 0!==r&&this._tweensPerObject[i].interpolations(r)}return this},y.prototype.from=function(t){for(var e=0;e<this._propertyChainStrings.length;e+=1){for(var i=this._propertyChainStrings[e],n=this._propertyChains[i],o=n.length,r=t,s=0;s<o&&void 0!==r;s+=1)r=r[n[s]];void 0!==r&&this._tweensPerObject[i].from(r)}return this},y.prototype.to=function(t,e,i,n,o){for(var r=0;r<this._propertyChainStrings.length;r+=1){for(var s=this._propertyChainStrings[r],a=this._propertyChains[s],h=a.length,u=t,l=0;l<h;l+=1)u=u[a[l]];var p=o;for(l=0;l<h&&void 0!==p;l+=1)p=p[a[l]];this._tweensPerObject[s].to(u,e,i,n,p)}return this._extendDuration(e),this},y.prototype.wait=function(t){for(var e=0;e<this._tweens.length;e+=1)this._tweens[e].wait(t);return this._extendDuration(t),this},y.prototype._update=function(){for(var t=0;t<this._tweens.length;t+=1){var e=this._tweens[t];e._time=this._time,e._update()}}},{"./AbstractTween":22,"./BriefPlayable":24}],29:[function(t,e,i){function n(){this._player=null,this._handle=null,this._startTime=0,this._time=0,this._speed=1,this._onStart=null,this._onPause=null,this._onResume=null,this._onUpdate=null,this._onStop=null}e.exports=n,Object.defineProperty(n.prototype,"speed",{get:function(){return this._speed},set:function(t){this.setSpeed(t)}}),Object.defineProperty(n.prototype,"time",{get:function(){return this._time},set:function(t){this.goTo(t)}}),n.prototype.onStart=function(t){return this._onStart=t,this},n.prototype.onUpdate=function(t){return this._onUpdate=t,this},n.prototype.onStop=function(t){return this._onStop=t,this},n.prototype.onPause=function(t){return this._onPause=t,this},n.prototype.onResume=function(t){return this._onResume=t,this},n.prototype.tweener=function(t){return null==t?console.warn("[Playable.tweener] Given tweener is invalid:",t):this._player=t,this},n.prototype.setSpeed=function(t){t<0?console.warn("[Playable.speed] This playable cannot have negative speed"):(0===t?0!==this._speed&&(this._startTime+=this._time/this._speed-this._time):0===this._speed?this._startTime+=this._time-this._time/t:this._startTime+=this._time/this._speed-this._time/t,this._speed=t,null!==this._player&&this._player._onPlayableChanged(this))},n.prototype.goTo=function(t,e){return 1===this._iterations?0===this._speed?this._startTime+=this._time-t:this._startTime+=(this._time-t)/this._speed:(e=e||0,0===this._speed?this._startTime+=this._time-t-e*this._duration:this._startTime+=(this._time-t-e*this._duration)/this._speed),this._time=t,null!==this._player&&this._player._onPlayableChanged(this),this},n.prototype.goToBeginning=function(){return this.goTo(0,0)},n.prototype.getDuration=function(){return 1/0},n.prototype._getEndTime=function(){return 1/0},n.prototype._setStartTime=function(t){this._startTime=t},n.prototype._getStartTime=function(){return this._startTime},n.prototype._isWithin=function(t){return this._startTime<t},n.prototype._overlaps=function(t,e){return(t-this._startTime)*(e-this._startTime)<=0},n.prototype.rewind=function(){return this.goTo(0,0),this},n.prototype.delay=function(t){return this.start(-t)},n.prototype.start=function(t){return null===this._player&&(this._player=TINA._startDefaultTweener()),!1===this._validate()||!1===this._player._add(this)||(null==t&&(t=0),this._startTime=this._player._time-t),this},n.prototype._start=function(){null!==this._onStart&&this._onStart()},n.prototype.stop=function(){if(null!==this._player)return!1===this._player._remove(this)||null!==this._onStop&&this._onStop(),this;console.warn("[Playable.stop] Trying to stop a playable that was never started.")},n.prototype.resume=function(){return!1===this._player._activate(this)||null!==this._onResume&&this._onResume(),this},n.prototype.pause=function(){return!1===this._player._remove(this)||null!==this._onPause&&this._onPause(),this},n.prototype._moveTo=function(t,e){e*=this._speed,this._time=(t-this._startTime)*this._speed,this._update(e),null!==this._onUpdate&&this._onUpdate(this._time,e)},n.prototype._update=function(){},n.prototype._validate=function(){}},{}],30:[function(t,e,i){var n=t("./Playable"),o=t("./DoublyList");function r(){n.call(this),this._activePlayables=new o,this._inactivePlayables=new o,this._playablesToRemove=new o,this._silent=!0,this._debug=!1}(r.prototype=Object.create(n.prototype)).constructor=r,(e.exports=r).prototype._add=function(t){return null===t._handle?(t._handle=this._inactivePlayables.add(t),t._player=this,!0):t._handle.container===this._playablesToRemove?(t._handle=this._playablesToRemove.removeByReference(t._handle),!0):(t._handle.container===this._activePlayables?this._warn("[Player._add] Playable is already present, and active"):t._handle.container===this._inactivePlayables?this._warn("[Player._add] Playable is already present, but inactive (could be starting)"):this._warn("[Player._add] Playable is used elsewhere"),!1)},r.prototype._remove=function(t){return null===t._handle?(this._warn("[Player._remove] Playable is not being used"),!1):t._handle.container===this._activePlayables?(t._handle=this._playablesToRemove.add(t._handle),!0):t._handle.container===this._inactivePlayables?(t._handle=this._inactivePlayables.removeByReference(t._handle),!0):(t._handle.container===this._playablesToRemove?this._warn("[Player._remove] Playable is already being removed"):this._warn("[Player._add] Playable is used elsewhere"),!1)},r.prototype.remove=function(t){return t._handle.container===this._activePlayables&&t.stop(),this._remove(t),this._onPlayableRemoved(t),this},r.prototype.removeAll=function(){for(var t=this._activePlayables.first;null!==t;){var e=t.next;t.object.stop(),t=e}return this._handlePlayablesToRemove(),this},r.prototype.possess=function(t){return null!==t._handle&&(t._handle.container===this._activePlayables||t._handle.container===this._inactivePlayables)},r.prototype._handlePlayablesToRemove=function(){for(;0<this._playablesToRemove.length;){var t=this._playablesToRemove.pop();t.object._handle=this._activePlayables.removeByReference(t)}0===this._activePlayables.length&&0===this._inactivePlayables.length&&this._onAllPlayablesRemoved()},r.prototype.clear=function(){return this._activePlayables.clear(),this._inactivePlayables.clear(),this._playablesToRemove.clear(),this._controls.clear(),this},r.prototype._warn=function(t){!1===this._silent&&console.warn(t),this._debug},r.prototype.silent=function(t){return this._silent=t||!1,this},r.prototype.debug=function(t){return this._debug=t||!1,this},r.prototype.stop=function(){for(var t=this._activePlayables.first;null!==t;){var e=t.next;t.object.stop(),t=e}this._handlePlayablesToRemove(),n.prototype.stop.call(this)},r.prototype._activate=function(t){this._inactivePlayables.removeByReference(t._handle),t._handle=this._activePlayables.addBack(t)},r.prototype._inactivate=function(t){null!==t._handle?(this._activePlayables.removeByReference(t._handle),t._handle=this._inactivePlayables.addBack(t)):this._warn("[Playable.stop] Cannot stop a playable that is not running")},r.prototype._updatePlayableList=function(t){var e,i;this._handlePlayablesToRemove(),i=0<t?(e=this._time-t,this._time):(e=this._time,this._time-t);for(var n=this._inactivePlayables.first;null!==n;){var o=n.object;n=n.next,o._overlaps(e,i)&&(this._activate(o),o._start())}},r.prototype._update=function(t,e){this._updatePlayableList(t);for(var i=this._activePlayables.first;null!==i;i=i.next)void 0===e?i.object._moveTo(this._time,t):i.object._moveTo(this._time,t,e)},r.prototype._onPlayableChanged=function(){},r.prototype._onPlayableRemoved=function(){},r.prototype._onAllPlayablesRemoved=function(){}},{"./DoublyList":27,"./Playable":29}],31:[function(e,i,n){var o=e("./BriefPlayable"),r=e("./DoublyList");function s(t,e){this.time=t,this.values=e}function a(t,e,i,n){this.object=t,this.properties=e,this.records=new r,this.currentRecord=null,this.isIn=!1,this.onIn=i||null,this.onOut=n||null}function h(t){if(this instanceof h==!1)return new h;o.call(this),this._duration=1/0,this._slackTime=0,this._maxRecordingDuration=t||1/0,this._recordedObjects=[],this._recordingObjects={},this._recordingObjectLabels=[],this._recording=!0,this._playing=!1,this._smooth=!1,this._onStartRecording=null,this._onStopRecording=null,this._onStartPlaying=null,this._onStopPlaying=null}a.prototype.erase=function(t,e){if(e<t){var i=t;t=e,e=i}var n=this.records.last;if(n.object.time<=e){for(;null!==n&&n.object.time>=t;){var o=n.previous;this.records.removeBeReference(n),n=o}null===this.currentRecord.container&&(this.currentRecord=n)}else{for(var r=this.records.first;null!==r&&r.object.time<=e;){var s=r.next;r.object.time>=t&&this.records.removeBeReference(r),r=s}null===this.currentRecord.container&&(this.currentRecord=r)}},a.prototype.record=function(t,e){if(0!==e||null===this.currentRecord||this.currentRecord.time!==t){for(var i=[],n=0;n<this.properties.length;n+=1)i.push(this.object[this.properties[n]]);var o=new s(t,i);0!==this.records.length?this.currentRecord.object.time<t?this.currentRecord=this.records.addAfter(this.currentRecord,o):this.currentRecord=this.records.addBefore(this.currentRecord,o):this.currentRecord=this.records.add(o)}},a.prototype.goTo=function(t){for(;this.currentRecord.object.time<t;)this.currentRecord=this.currentRecord.next;for(;t<this.currentRecord.object.time;)this.currentRecord=this.currentRecord.previous},a.prototype.play=function(e,i,n){var o,r=this.properties.length,s=this.records.first,a=this.records.last;if((o=0===i?this.isIn:!0===this.isIn?s.object.time<e&&e<a.object.time:s.object.time<=e&&e<=a.object.time)!==this.isIn)this.isIn=!this.isIn,!0===o&&null!==this.onIn&&this.onIn();else if(!1===this.isIn)return;for(var h,u=null===this.currentRecord.previous?this.currentRecord:this.currentRecord.previous;this.currentRecord.object.time<=e;){u=this.currentRecord;var l=this.currentRecord.next;if(null===l)break;this.currentRecord=l}for(;e<=u.object.time;){var p=(this.currentRecord=u).previous;if(null===p)break;u=p}if(n){var c=u.object.time,d=this.currentRecord.object.time,f=u.object.values,v=this.currentRecord.object.values,_=d-c,y=(t-c)/_,g=(d-t)/_;for(h=0;h<r;h+=1)this.object[this.properties[h]]=f[h]*y+v[h]*g}else{var m=this.currentRecord.object.values;for(h=0;h<r;h+=1)this.object[this.properties[h]]=m[h]}!1===o&&null!==this.onOut&&this.onOut()},(h.prototype=Object.create(o.prototype)).constructor=h,(i.exports=h).prototype.getDuration=function(){return(!0===this._playing?this._time>this._maxRecordingDuration?this._maxRecordingDuration:this._time:1/0)*this._iterations/this._speed},h.prototype.smooth=function(t){return this._smooth=t,this},h.prototype.onStartRecording=function(t){return this._onStartRecording=t,this},h.prototype.onStopRecording=function(t){return this._onStopRecording=t,this},h.prototype.onStartPlaying=function(t){return this._onStartPlaying=t,this},h.prototype.onStopPlaying=function(t){return this._onStopPlaying=t,this},h.prototype.reset=function(){return this._recordedObjects=[],this._recordingObjects={},this._recordingObjectLabels=[],this},h.prototype.record=function(t,e,i,n,o){var r=new a(e,i,n,o);return this._recordingObjects[t]=r,this._recordedObjects.push(r),this._recordingObjectLabels.push(t),this},h.prototype.stopRecordingObject=function(t){delete this._recordingObjects[t];var e=this._recordingObjectLabels.indexOf(t);return-1===e?console.warn("[Recorder.stopRecordingObject] Trying to stop recording an object that is not being recording:",t):this._recordingObjectLabels.splice(e,1),this},h.prototype.removeRecordedObject=function(t){var e=this._recordingObjects[t];delete this._recordingObjects[t];var i=this._recordingObjectLabels.indexOf(t);-1!==i&&this._recordingObjectLabels.splice(i,1);var n=this._recordedObjects.indexOf(e);return-1===n?console.warn("[Recorder.removeRecordedObject] Trying to remove an object that was not recorded:",t):this._recordingObjectLabels.splice(n,1),this},h.prototype.recording=function(t){return this._recording!==t&&(this._recording=t,!0===this._recording?(!0===this._playing&&(null!==this._onStopPlaying&&this._onStopPlaying(),this._playing=!1),this._duration=1/0,null!==this._player&&this._player._onPlayableChanged(this),null!==this._onStartRecording&&this._onStartRecording()):null!==this._onStopRecording&&this._onStopRecording()),this},h.prototype.playing=function(t){return this._playing!==t&&(this._playing=t,!0===this._playing?(!0===this._recording&&(null!==this._onStopRecording&&this._onStopRecording(),this._recording=!1),this._duration=this._time,this.goToBeginning(this._startTime+this.getDuration()),null!==this._onStartPlaying&&this._onStartPlaying()):null!==this._onStopPlaying&&this._onStopPlaying()),this},h.prototype._update=function(t){var e,i=this._slackTime+this._time;if(!0===this._recording){var n,o;o=0<t?0<(n=this._time-this._maxRecordingDuration):(n=this._time)<0;var r=this._recordingObjectLabels.length;for(e=0;e<r;e+=1){var s=this._recordingObjectLabels[e],a=this._recordingObjects[s];a.record(i,t),!0===o&&a.erase(0,n)}0<n&&(this._slackTime+=n,this._setStartTime(this._startTime+n),this._player._onPlayableChanged(this))}else if(!0===this._playing){var h=this._recordedObjects.length;for(e=0;e<h;e+=1)this._recordedObjects[e].play(i,t,this._smooth)}}},{"./BriefPlayable":24,"./DoublyList":27}],32:[function(t,e,i){var n=t("./Timeline"),o=t("./Delay"),r=t("./DoublyList");function s(){if(this instanceof s==!1)return new s;this._sequencedPlayables=new r,n.call(this)}(s.prototype=Object.create(n.prototype)).constructor=s,(e.exports=s).prototype.add=function(t){return this._sequencedPlayables.addBack(t),n.prototype.add.call(this,t,this._duration)},s.prototype.addDelay=function(t){return this.add(new o(t))},s.prototype._reconstruct=function(){var t,e,i=this._activePlayables.first;null!==i&&(t=i.object,e=this._time-t._getStartTime());for(var n=0,o=this._sequencedPlayables.first;null!==o;o=o.next){var r=o.object;r._setStartTime(n),n=r._getEndTime()}if(null!==i){this._getStartTime();var s=e-(this._time-t._getStartTime());this._startTime+=s}this._duration=n,null!==this._player&&this._player._onPlayableChanged(this)},s.prototype.substitute=function(t,e){if(0!==this._sequencedPlayables.length){var i=this._sequencedPlayables.getNode(t);this._sequencedPlayables.addAfter(i,e),this._add(e),this.remove(t)}else this._warn("[Sequence.substitute] The sequence is empty!")},s.prototype._onPlayableRemoved=function(t){this._sequencedPlayables.remove(t),0!==this._sequencedPlayables.length&&this._reconstruct()},s.prototype._onPlayableChanged=s.prototype._reconstruct},{"./Delay":26,"./DoublyList":27,"./Timeline":35}],33:[function(t,e,i){var n,o=t("./DoublyList"),r=(n="undefined"!=typeof window?window:"undefined"!=typeof global?global:(console.warn("[TINA] Your environment might not support TINA."),this)).requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(t){n.setTimeout(t,1e3/60)},s=n.performance||Date,a={_activeTweeners:new o,_inactiveTweeners:new o,_tweenersToRemove:new o,_defaultTweener:null,_startTime:0,_time:0,_running:!1,_onStart:null,_onPause:null,_onResume:null,_onUpdate:null,_onStop:null,_pauseOnLostFocus:!1,_pauseOnLostFocusInitialised:!1,onStart:function(t){return this._onStart=t,this},onUpdate:function(t){return this._onUpdate=t,this},onStop:function(t){return this._onStop=t,this},onPause:function(t){return this._onPause=t,this},isRunning:function(){return!0===this._running},update:function(){var t=s.now()-this._startTime,e=t-this._time;for(e<0?(e=1,--this._startTime,this._time+=1):this._time=t;0<this._tweenersToRemove.length;){var i=this._tweenersToRemove.pop();i._handle=this._activeTweeners.removeByReference(i._handle)}for(;0<this._inactiveTweeners.length;){var n=this._inactiveTweeners.pop();n._handle=this._activeTweeners.addBack(n),n._start()}for(var o=this._activeTweeners.first;null!==o;o=o.next)o.object._moveTo(this._time,e);null!==this._onUpdate&&this._onUpdate(this._time,e)},reset:function(){var t=s.now()-this._time;this._startTime+=t,this._time=0},start:function(){if(!1!==this._startAutomaticUpdate()){for(null!==this._onStart&&this._onStart();0<this._inactiveTweeners.length;){var t=this._inactiveTweeners.first;this._activate(t.object)}return this}},stop:function(){if(!1!==this._stopAutomaticUpdate()){for(;0<this._activePlayables.length;){this._activePlayables.first.object.stop()}return null!==this._onStop&&this._onStop(),this}},_startAutomaticUpdate:function(){if(!0===this._running)return console.warn("[TINA.start] TINA is already running"),!1;return this.reset(),this._running=!0,r(function t(){!0===a._running&&(a.update(),r(t))}),!0},_stopAutomaticUpdate:function(){return!1===this._running?(console.warn("[TINA.pause] TINA is not running"),!1):!(this._running=!1)},pause:function(){if(!1!==this._stopAutomaticUpdate()){for(var t=this._activeTweeners.first;null!==t;t=t.next)t.object._pause();return null!==this._onPause&&this._onPause(),this}},resume:function(){if(!1!==this._startAutomaticUpdate()){null!==this._onResume&&this._onResume();for(var t=this._activeTweeners.first;null!==t;t=t.next)t.object._resume();return this}},_initialisePauseOnLostFocus:function(){var t,e;if(!0!==this._pauseOnLostFocusInitialised)if(void 0!==document)if(void 0!==document.hidden?(t="hidden",e="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),void 0!==document[t]){var i=!(this._pauseOnLostFocusInitialised=!0);document.addEventListener(e,function(){document[t]&&(i=a.isRunning())&&a._pauseOnLostFocus&&a.pause(),document[t]||i&&a._pauseOnLostFocus&&a.resume()},!1)}else console.warn("[Tweener] Cannot pause on lost focus because the browser does not support the Page Visibility API");else console.warn("[TINA.pauseOnLostFocus] Cannot pause on lost focus because TINA is not running in a webpage (node.js does not allow this functionality)")},pauseOnLostFocus:function(t){return!0===t&&!1===this._pauseOnLostFocusInitialised&&this._initialisePauseOnLostFocus(),this._pauseOnLostFocus=t,this},_add:function(t){if(!1===this._running&&this.start(),null===t._handle)return t._handle=this._inactiveTweeners.add(t),void(t._player=this);t._handle.container!==this._tweenersToRemove||(t._handle=this._tweenersToRemove.removeByReference(t._handle))},add:function(t){return this._add(t),this},_inactivate:function(t){null!==t._handle&&this._activePlayables.removeByReference(t._handle),t._handle=this._inactivePlayables.addBack(t)},_remove:function(t){null!==t._handle&&(t._handle.container!==this._activeTweeners?t._handle.container!==this._inactiveTweeners||(t._handle=this._inactiveTweeners.removeByReference(t._handle)):t._handle=this._tweenersToRemove.add(t._handle))},remove:function(t){return this._remove(t),this},setDefaultTweener:function(t){return this._defaultTweener=t,this},getDefaultTweener:function(){if(null===this._defaultTweener){var t=this.Timer;this._defaultTweener=new t}return this._defaultTweener},_startDefaultTweener:function(){var t=this.getDefaultTweener();return this._add(t),t}};e.exports=n.TINA=a},{"./DoublyList":27}],34:[function(t,e,i){var n=t("./Tweener");function o(t){if(this instanceof o==!1)return new o(t);n.call(this),this.tupt=t||1}(o.prototype=Object.create(n.prototype)).constructor=o,(e.exports=o).prototype._moveTo=function(t,e){this._time+=this.tupt,e=this.tupt,this._update(e),null!==this._onUpdate&&this._onUpdate(this._time,e)},o.prototype.convertToTicks=function(t){return t/this.tupt},o.prototype.convertToTimeUnits=function(t){return t*this.tupt}},{"./Tweener":40}],35:[function(t,e,i){var n=t("./BriefPlayer");function o(){if(this instanceof o==!1)return new o;n.call(this)}(o.prototype=Object.create(n.prototype)).constructor=o,(e.exports=o).prototype.add=function(t,e){null==e&&(e=0),t._setStartTime(e),this._add(t);var i=t._getEndTime();return i>this._duration&&this._setDuration(i),this}},{"./BriefPlayer":25}],36:[function(t,e,i){var n=t("./Tweener");function o(t){if(this instanceof o==!1)return new o(t);n.call(this),this._speed=t/1e3||1}(o.prototype=Object.create(n.prototype)).constructor=o,e.exports=o,Object.defineProperty(o.prototype,"tups",{get:function(){return 1e3*this._speed},set:function(t){this.speed=t/1e3}}),o.prototype.convertToSeconds=function(t){return t/(1e3*this._speed)},o.prototype.convertToTimeUnits=function(t){return t*this._speed*1e3}},{"./Tweener":40}],37:[function(t,e,i){var c=[[[function(t,e){var i=this.prop;t[i]=this.from[i]*(1-e)+this.to[i]*e},function(t,e){for(var i=this.props,n=0;n<this.props.length;n+=1){var o=i[n];t[o]=this.from[o]*(1-e)+this.to[o]*e}}],[function(t,e){var i=this.prop;t[i]=this.interps[i](e,this.from[i],this.to[i],this.interpParams[i])},function(t,e){for(var i=this.props,n=0;n<i.length;n+=1){var o=i[n];t[o]=this.interps[o](e,this.from[o],this.to[o],this.interpParams[o])}}]],[[function(t,e){e=this.easing(e,this.easingParam);var i=this.prop;t[i]=this.from[i]*(1-e)+this.to[i]*e},function(t,e){var i=this.props;e=this.easing(e,this.easingParam);for(var n=0;n<i.length;n+=1){var o=i[n];t[o]=this.from[o]*(1-e)+this.to[o]*e}}],[function(t,e){var i=this.prop;t[i]=this.interps[i](this.easing(e,this.easingParam),this.from[i],this.to[i],this.interpParams[i])},function(t,e){var i=this.props;e=this.easing(e,this.easingParam);for(var n=0;n<i.length;n+=1){var o=i[n];t[o]=this.interps[o](e,this.from[o],this.to[o],this.interpParams[o])}}]]];e.exports=function(t,e,i,n,o,r,s,a,h){var u,l,p;this.start=n,this.end=n+o,this.duration=o,this.from=e,this.to=i,r?(u=1,this.easing=r,this.easingParam=s):u=0,null===a?l=0:(l=1,this.interps=a,this.interpParams=h||{}),1===t.length?(p=0,this.prop=t[0],this.props=null):(p=1,this.prop=null,this.props=t),this.update=c[u][l][p]}},{}],38:[function(t,e,i){var d=[[[function(t,e){var i=this.prop,n=this.from[i]*(1-e)+this.to[i]*e;t[i]=t[i]+(n-this.prev),this.prev=n},function(t,e){for(var i=this.props,n=0;n<this.props.length;n+=1){var o=i[n],r=this.from[o]*(1-e)+this.to[o]*e;t[o]=t[o]+(r-this.prevs[o]),this.prevs[o]=r}}],[function(t,e){var i=this.prop,n=this.interps[i](e,this.from[i],this.to[i],this.interpParams[i]);t[i]=t[i]+(n-this.prev),this.prev=n},function(t,e){for(var i=this.props,n=0;n<i.length;n+=1){var o=i[n],r=this.interps[o](e,this.from[o],this.to[o],this.interpParams[o]);t[o]=t[o]+(r-this.prevs[o]),this.prevs[o]=r}}]],[[function(t,e){e=this.easing(e,this.easingParams);var i=this.prop,n=this.from[i]*(1-e)+this.to[i]*e;t[i]=t[i]+(n-this.prev),this.prev=n},function(t,e){var i=this.props;e=this.easing(e,this.easingParams);for(var n=0;n<i.length;n+=1){var o=i[n],r=this.from[o]*(1-e)+this.to[o]*e;t[o]=t[o]+(r-this.prevs[o]),this.prevs[o]=r}}],[function(t,e){var i=this.prop,n=this.interps[i](this.easing(e,this.easingParams),this.from[i],this.to[i],this.interpParams[i]);t[i]=t[i]+(n-this.prev),this.prev=n},function(t,e){var i=this.props;e=this.easing(e,this.easingParams);for(var n=0;n<i.length;n+=1){var o=i[n],r=this.interps[o](e,this.from[o],this.to[o],this.interpParams[o]);t[o]=t[o]+(r-this.prevs[o]),this.prevs[o]=r}}]]];e.exports=function(t,e,i,n,o,r,s,a,h){var u,l,p;if(this.start=n,this.end=n+o,this.duration=o,this.from=e,this.to=i,r?(u=1,this.easing=r,this.easingParam=s):u=0,null===a?l=0:(l=1,this.interps=a,this.interpParams=h||{}),1===t.length)p=0,this.prop=t[0],this.props=null,this.prev=0,this.prevs=null;else{p=1,this.prop=null,this.props=t,this.prev=null,this.prevs={};for(var c=0;c<t.length;c+=1)this.prevs[t[c]]=0}this.update=d[u][l][p]}},{}],39:[function(t,e,i){var n=t("./BriefPlayable"),r=t("./AbstractTween");function o(t,e){if(this instanceof o==!1)return new o(t,e);n.call(this),r.call(this,t,e)}t("./inherit")((o.prototype=Object.create(n.prototype)).constructor=o,r),(e.exports=o).prototype.to=function(t,e,i,n,o){return r.prototype.to.call(this,t,e,i,n,o),null!==this._player&&this._player._onPlayableChanged(this),this},o.prototype.wait=function(t){return r.prototype.to.wait(this,t),null!==this._player&&this._player._onPlayableChanged(this),this}},{"./AbstractTween":22,"./BriefPlayable":24,"./inherit":43}],40:[function(t,e,i){var n=t("./Player"),o=t("./TINA");function r(){n.call(this),this._player=o}(r.prototype=Object.create(n.prototype)).constructor=r,(e.exports=r).prototype._inactivate=function(t){this._remove(t)},r.prototype.useAsDefault=function(){return o.setDefaultTweener(this),this}},{"./Player":30,"./TINA":33}],41:[function(t,e,i){var n=Math.PI,o=Math.PI/2,r=2*Math.PI,s=2.718281828;i.none=function(){return 1},i.linear=function(t){return t},i.flash=function(t,e){return t+t*e-t*t*e},i.parabolic=function(t){var e=2*t-1;return 1-e*e},i.trigo=function(t,e){return.5*(1-Math.cos(r*t*e))},i.elastic=function(t,e){if(1===t)return 1;var i=(1+(e/=e+1))*Math.log(1-t)/Math.log(e);return Math.cos(i-o)*Math.pow(e,i)},i.quadIn=function(t){return t*t},i.quadOut=function(t){return 2*t-t*t},i.quadInOut=function(t){return t<.5?2*t*t:2*(2*t-t*t)-1},i.cubicIn=function(t){return t*t*t},i.cubicOut=function(t){return 3*t-3*t*t+t*t*t},i.cubicInOut=function(t){return t<.5?4*t*t*t:4*(3*t-3*t*t+t*t*t)-3},i.quarticIn=function(t){return t*t*t*t},i.quarticOut=function(t){var e=t*t;return 4*t-6*e+4*e*t-e*e},i.quarticInOut=function(t){if(t<.5)return 8*t*t*t*t;var e=t*t;return 8*(4*t-6*e+4*e*t-e*e)-7},i.polyIn=function(t,e){return Math.pow(t,e)},i.polyOut=function(t,e){return 1-Math.pow(1-t,e)},i.polyInOut=function(t,e){return t<.5?Math.pow(2*t,e)/2:(2-Math.pow(2*(1-t),e))/2},i.sineIn=function(t){return 1-Math.cos(o*t)},i.sineOut=function(t){return Math.sin(o*t)},i.sineInOut=function(t){return t<.5?(1-Math.cos(n*t))/2:(1+Math.sin(n*(t-.5)))/2},i.expIn=function(t,e){return(1-Math.pow(s,e*t))/(1-Math.pow(s,e))},i.expOut=function(t,e){return(1-Math.pow(s,-e*t))/(1-Math.pow(s,-e))},i.expInOut=function(t,e){return t<.5?(1-Math.pow(s,2*e*t))/(1-Math.pow(s,e))/2:.5+(1-Math.pow(s,e-2*e*t))/(1-Math.pow(s,-e))/2},i.circIn=function(t){return 1-Math.sqrt(1-Math.pow(t,2))},i.circOut=function(t){return Math.sqrt(1-Math.pow(1-t,2))},i.circInOut=function(t){return t<.5?(1-Math.sqrt(1-4*t*t))/2:(1+Math.sqrt(8*t-3-4*t*t))/2},i.elasticIn=function(t,e){if(0===t)return 0;var i=(1+(e/=e+1))*Math.log(t)/Math.log(e);return Math.cos(i)*Math.pow(e,i)},i.elasticOut=function(t,e){if(1===t)return 1;var i=(1+(e/=e+1))*Math.log(1-t)/Math.log(e);return 1-Math.cos(i)*Math.pow(e,i)},i.elasticInOut=function(t,e){var i;return t<.5?0===t?0:(i=(1+(e/=e+1))*Math.log(2*t)/Math.log(e),.5*Math.cos(i)*Math.pow(e,i)):1===t?1:(i=(1+(e/=e+1))*Math.log(2-2*t)/Math.log(e),.5+.5*(1-Math.cos(i)*Math.pow(e,i)))},i.bounceIn=function(t,e){if(0===t)return 0;var i=(1+(e/=e+1))*Math.log(t)/Math.log(e);return Math.abs(Math.cos(i)*Math.pow(e,i))},i.bounceOut=function(t,e){if(1===t)return 1;var i=(1+(e/=e+1))*Math.log(1-t)/Math.log(e);return 1-Math.abs(Math.cos(i)*Math.pow(e,i))},i.bounceInOut=function(t,e){var i;return t<.5?0===t?0:(i=(1+(e/=e+1))*Math.log(2*t)/Math.log(e),Math.abs(.5*Math.cos(i)*Math.pow(e,i))):1===t?1:(i=(1+(e/=e+1))*Math.log(2-2*t)/Math.log(e),.5+.5*(1-Math.abs(Math.cos(i)*Math.pow(e,i))))},i.backIn=function(t,e){return t*t*((e+1)*t-e)},i.backOut=function(t,e){return--t*t*((e+1)*t+e)+1},i.backInOut=function(t,e){return t<.5?(t*=2)*t*((e+1)*t-e)*.5:(t=2*t-2)*t*((e+1)*t+e)*.5+1}},{}],42:[function(t,e,i){var n=t("./TINA.js");n.Delay=t("./Delay"),n.BriefExtension=t("./BriefExtension"),n.BriefPlayable=t("./BriefPlayable"),n.BriefPlayer=t("./BriefPlayer"),n.easing=t("./easing"),n.interpolation=t("./interpolation"),n.NestedTween=t("./NestedTween"),n.PixiTween=t("./NestedTween"),n.Playable=t("./Playable"),n.Player=t("./Player"),n.Recorder=t("./Recorder"),n.Sequence=t("./Sequence"),n.Ticker=t("./Ticker"),n.Timeline=t("./Timeline"),n.Timer=t("./Timer"),n.Tween=t("./Tween"),n.Tweener=t("./Tweener"),e.exports=n},{"./BriefExtension":23,"./BriefPlayable":24,"./BriefPlayer":25,"./Delay":26,"./NestedTween":28,"./Playable":29,"./Player":30,"./Recorder":31,"./Sequence":32,"./TINA.js":33,"./Ticker":34,"./Timeline":35,"./Timer":36,"./Tween":39,"./Tweener":40,"./easing":41,"./interpolation":44}],43:[function(t,e,i){e.exports=function(t,e){for(var i=Object.keys(e.prototype),n=0;n<i.length;n+=1){var o=i[n];t.prototype[o]=e.prototype[o]}}},{}],44:[function(t,e,i){var v,_,L,B;function N(t,e,i){return t[0]*e+t[1]*i}i.none=function(t,e,i){return i},i.linear=function(t,e,i){return e*(1-t)+i*t},i.discrete=function(t,e,i,n){return void 0===n&&(n=1),Math.floor((e*(1-t)+i*t)/n)*n},i.vectorXY=function(t,e,i){return{x:e.x*(1-t)+i.x*t,y:e.y*(1-t)+i.y*t}},i.vectorXYZ=function(t,e,i){return{x:e.x*(1-t)+i.x*t,y:e.y*(1-t)+i.y*t,z:e.z*(1-t)+i.z*t}},i.vector=function(t,e,i){for(var n=[],o=0;o<e.length;o+=1)n[o]=e[o]*(1-t)+i[o]*t;return n},i.state=function(t,e,i,n){var o=i.length+2,r=Math.floor(t*o);return r<1?e:o-1<=r?i:n[r-1]},i.colorRGB=function(t,e,i){return{r:e.r*(1-t)+i.r*t,g:e.g*(1-t)+i.g*t,b:e.b*(1-t)+i.b*t}},i.colorRGBA=function(t,e,i){return{r:e.r*(1-t)+i.r*t,g:e.g*(1-t)+i.g*t,b:e.b*(1-t)+i.b*t,a:e.a*(1-t)+i.a*t}},i.colorRGBToHexa=function(t,e,i){var n=Math.round(e.r*(1-t)+i.r*t),o=Math.round(e.g*(1-t)+i.g*t),r=Math.round(e.b*(1-t)+i.b*t);return"#"+n.toString(16)+o.toString(16)+r.toString(16)},i.colorRGBToString=function(t,e,i){var n=Math.round(e.r*(1-t)+i.r*t),o=Math.round(e.g*(1-t)+i.g*t),r=Math.round(e.b*(1-t)+i.b*t);return"rgb("+n.toString(16)+","+o.toString(16)+","+r.toString(16)+")"},i.colorRGBAToString=function(t,e,i){var n=Math.round(e.r*(1-t)+i.r*t),o=Math.round(e.g*(1-t)+i.g*t),r=Math.round(e.b*(1-t)+i.b*t),s=Math.round(e.a*(1-t)+i.a*t);return"rgba("+n.toString(16)+","+o.toString(16)+","+r.toString(16)+","+s+")"},i.string=function(t,e,i){for(var n=e.length,o=i.length,r="",s=0;s<o;s+=1){var a=i.charCodeAt(s),h=n<=s?a<97?65:97:e.charCodeAt(s),u=Math.round(h*(1-t)+a*t);r+=String.fromCharCode(u)}return r},i.bezierQuadratic=function(t,e,i,n){var o=1-t;return o*o*e+t*(2*o*n[0]+t*i)},i.bezierCubic=function(t,e,i,n){var o=1-t;return o*o*o*e+t*(3*o*o*n[0]+t*(3*o*n[1]+t*i))},i.bezierQuartic=function(t,e,i,n){var o=1-t,r=2*o;return r*r*e+t*(4*o*r*n[0]+t*(6*r*n[1]+t*(4*o*n[2]+t*i)))},i.bezierQuintic=function(t,e,i,n){var o=1-t,r=2*o;return r*r*o*e+t*(5*r*r*n[0]+t*(10*o*r*n[1]+t*(10*r*n[2]+t*(5*o*n[3]+t*i))))},i.bezier=function(t,e,i,n){var o=n.length,r=1-t,s=i,a=o;for(k=1;k<o;--k)s=s*t+a*Math.pow(r,k)*n[o-k],a*=(o-k)/(k+1);return s*t+e*Math.pow(r,o)},i.bezier2d=function(t,e,i,n){for(var o,r,s=n.length,a=1-t,h=i[0],u=i[1],l=s,p=1;p<s;--p)h=h*t+(o=l*Math.pow(a,p))*(r=n[s-p])[0],u=u*t+o*r[1],l*=(s-p)/(p+1);return o=Math.pow(a,s),[h*t+e[0]*o,u*t+e[1]*o]},i.bezier3d=function(t,e,i,n){for(var o,r,s=n.length,a=1-t,h=i[0],u=i[1],l=i[2],p=s,c=1;c<s;--c)h=h*t+(o=p*Math.pow(a,c))*(r=n[s-c])[0],u=u*t+o*r[1],l=l*t+o*r[2],p*=(s-c)/(c+1);return o=Math.pow(a,s),[h*t+e[0]*o,u*t+e[1]*o,l*t+e[2]*o]},i.bezierKd=function(t,e,i,n){for(var o,r,s=n.length,a=1-t,h=e.length,u=[],l=0;l<h;l+=1)u[l]=i[l];for(var p=s,c=1;c<s;--c){for(o=p*Math.pow(a,c),r=n[s-c],l=0;l<h;l+=1)u[l]=u[l]*t+o*r[l];p*=(s-c)/(c+1)}for(o=Math.pow(a,s),l=0;l<h;l+=1)u[l]=u[l]*t+e[l]*o;return u},i.catmullRom=function(t,e,i,n){if(1===t)return n;var o=e.length,r=i.length+1;t*=r;for(var s=Math.floor(t),a=(t-=s)*t,h=t*a,u=-.5*h+a-.5*t,l=1.5*h-2.5*a+1,p=-1.5*h+2*a+.5*t,c=.5*h-.5*a,d=s-2,f=s-1,v=s,_=s+1,y=d<0?e:i[d],g=f<0?e:i[f],m=_<r-2?i[v]:n,b=_<r-2?i[_]:n,w=[],x=0;x<o;x+=1)w[x]=y[x]*u+g[x]*l+m[x]*p+b[x]*c;return w},i.noise=(v=[182,235,131,26,88,132,100,117,202,176,10,19,83,243,75,52,252,194,32,30,72,15,124,53,236,183,121,103,175,39,253,120,166,33,237,141,99,180,18,143,69,136,173,21,210,189,16,142,190,130,109,186,104,80,62,51,165,25,122,119,42,219,146,61,149,177,54,158,27,170,60,201,159,193,203,58,154,222,78,138,220,41,98,14,156,31,29,246,81,181,40,161,192,227,35,241,135,150,89,68,134,114,230,123,187,179,67,217,71,218,7,148,228,251,93,8,140,125,73,37,82,28,112,24,174,118,232,137,191,133,147,245,6,172,95,113,185,205,254,116,55,198,57,152,128,233,74,225,34,223,79,111,215,85,200,9,242,12,167,44,20,110,107,126,86,231,234,76,207,102,214,238,221,145,213,64,197,38,168,157,87,92,255,212,49,196,240,90,63,0,77,94,1,108,91,17,224,188,153,250,249,199,127,59,46,184,36,43,209,206,248,4,56,47,226,13,144,22,11,247,70,244,48,97,151,195,96,101,45,66,239,178,171,160,84,65,23,3,211,162,163,50,105,129,155,169,115,5,106,2,208,204,139,229,164,216,182],_=[-1,1],function(t,e,i,n){for(var o=2,r=n.per||1,s=n.frq||2,a=n.oct||4,h=n.off||0,u=0,l=n.x+h,p=0;p<a;p+=1){var c=255&(l|l),d=l-(l|l),f=1-d;u+=o*(f*f*d*(3-2*f)*_[1&v[c]]-d*d*f*(3-2*d)*_[1&v[1+c]]),l*=(l-h)*s+h,o*=r}return e*(1-(t+=u*(1===r?1/a:.5*(1-r)/(1-Math.pow(r,a)))))+i*t}),i.simplex2d=(L=[182,235,131,26,88,132,100,117,202,176,10,19,83,243,75,52,252,194,32,30,72,15,124,53,236,183,121,103,175,39,253,120,166,33,237,141,99,180,18,143,69,136,173,21,210,189,16,142,190,130,109,186,104,80,62,51,165,25,122,119,42,219,146,61,149,177,54,158,27,170,60,201,159,193,203,58,154,222,78,138,220,41,98,14,156,31,29,246,81,181,40,161,192,227,35,241,135,150,89,68,134,114,230,123,187,179,67,217,71,218,7,148,228,251,93,8,140,125,73,37,82,28,112,24,174,118,232,137,191,133,147,245,6,172,95,113,185,205,254,116,55,198,57,152,128,233,74,225,34,223,79,111,215,85,200,9,242,12,167,44,20,110,107,126,86,231,234,76,207,102,214,238,221,145,213,64,197,38,168,157,87,92,255,212,49,196,240,90,63,0,77,94,1,108,91,17,224,188,153,250,249,199,127,59,46,184,36,43,209,206,248,4,56,47,226,13,144,22,11,247,70,244,48,97,151,195,96,101,45,66,239,178,171,160,84,65,23,3,211,162,163,50,105,129,155,169,115,5,106,2,208,204,139,229,164,216,182,235,131,26,88,132,100,117,202,176,10,19,83,243,75,52,252,194,32,30,72,15,124,53,236,183,121,103,175,39,253,120,166,33,237,141,99,180,18,143,69,136,173,21,210,189,16,142,190,130,109,186,104,80,62,51,165,25,122,119,42,219,146,61,149,177,54,158,27,170,60,201,159,193,203,58,154,222,78,138,220,41,98,14,156,31,29,246,81,181,40,161,192,227,35,241,135,150,89,68,134,114,230,123,187,179,67,217,71,218,7,148,228,251,93,8,140,125,73,37,82,28,112,24,174,118,232,137,191,133,147,245,6,172,95,113,185,205,254,116,55,198,57,152,128,233,74,225,34,223,79,111,215,85,200,9,242,12,167,44,20,110,107,126,86,231,234,76,207,102,214,238,221,145,213,64,197,38,168,157,87,92,255,212,49,196,240,90,63,0,77,94,1,108,91,17,224,188,153,250,249,199,127,59,46,184,36,43,209,206,248,4,56,47,226,13,144,22,11,247,70,244,48,97,151,195,96,101,45,66,239,178,171,160,84,65,23,3,211,162,163,50,105,129,155,169,115,5,106,2,208,204,139,229,164,216],B=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[1,0],[-1,0],[0,1],[0,-1],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]],function(t,e,i,n){for(var o=2,r=n.per||1,s=n.frq||2,a=n.oct||4,h=n.off||{x:0,y:0},u=u,l=n.x+h.x,p=n.y+h.y,c=0;c<a;c+=1){var d,f,v,_,y,g=(l+p)*(.5*(Math.sqrt(3)-1)),m=Math.floor(l+g),b=Math.floor(p+g),w=(3-Math.sqrt(3))/6,x=(m+b)*w,T=m-x,S=b-x;y=(S=p-S)<(T=l-T)?(_=1,0):(_=0,1);var P=T-_+w,R=S-y+w,j=T-1+2*w,M=S-1+2*w,I=255&m,C=255&b,E=.5-T*T-S*S,A=.5-P*P-R*R,O=.5-j*j-M*M;d=E<0?0:(E*=E)*E*N(B[15&L[I+L[C]]],T,S),f=A<0?0:(A*=A)*A*N(B[15&L[I+_+L[C+y]]],P,R),v=O<0?0:(O*=O)*O*N(B[15&L[1+I+L[1+C]]],j,M),u+=70*o*(d+f+v),l*=(l-h.x)*s+h.x,p*=(p-h.y)*s+h.y,o*=r}return e*(1-(t+=u*(1===r?1/a:.5*(1-r)/(1-Math.pow(r,a)))))+i*t})},{}],45:[function(t,e,i){var n=t("./constants"),p=t("./castRay"),o=n.POINT_TYPE,r=n.CAST_PER_CORNER_ORIENTATION;function s(t,e,i,n){this.x=t||0,this.y=e||0,this.start=null,this.end=null,this.type=o.GROOVE,this.orientation=i,this.id=n,this.cast=[[],[],[],[]]}(e.exports=s).prototype.initAsCorner=function(t){this.type=o.CORNER;var e=r[this.orientation];this._initCastableSegments(t,e[0]),this._initCastableSegments(t,e[1]),this._optimizeCast()},s.prototype._initCastableSegments=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];n.orientation!==e.s1&&n.orientation!==e.s2||(e.x*n.start.x>e.x*this.x&&e.y*n.start.y>e.y*this.y||e.x*n.end.x>e.x*this.x&&e.y*n.end.y>e.y*this.y)&&this.cast[e.listId].push(n)}};var h={tr:1/0};function c(t,e){return t[0]-e[0]}s.prototype.projectRaycast=function(t,e){for(var i=h,n=null,o=this.cast[e],r=0;r<o.length;r++){var s=o[r],a=p(t,this,s);a&&(a.ts<0||1<a.ts||a.tr<i.tr&&(i=a,n=s))}return n?(i.point=this,i.wall=n,i):null},s.prototype._optimizeCast=function(){for(var t=0;t<4;t++)for(var e=this.cast[t],i=e.length-1;0<=i;i--)this._isWallCovered(e[i])&&e.splice(i,1)},s.prototype._isWallCovered=function(t){for(var e=[],i=0;i<4;i++)for(var n=this.cast[i],o=0;o<n.length;o++){var r=n[o];if(r!==t){var s,a,h=p(this,r.start,t);if(h){if(s=h.ts,h.tr<0)s=-1/0;else if(h.tr<1)continue}else s=-1/0;var u=p(this,r.end,t);if(u){if(a=u.ts,u.tr<0)a=0;else if(u.tr<1)continue}else a=0;e.push([s,a])}}if(0===e.length)return!1;if(e.sort(c),0<e[0][0])return!1;var l=e[0][1];if(1<=l)return!0;for(o=1;o<e.length;o++){if(l<e[o][0])return!1;if(1<=(l=e[o][1]))return!0}return!1}},{"./castRay":49,"./constants":50}],46:[function(t,e,i){var n=t("./SortedList");function o(t,e){return t.ts-e.ts}function r(){this.corners={},this.walls={}}(e.exports=r).prototype.addRaycast=function(t,e){var i=(this.corners[t.id]=e).wall.id;return this.walls[i]||(this.walls[i]=new n(o)),this.walls[i].add(e)}},{"./SortedList":47}],47:[function(t,e,i){function r(t,e,i,n){this.object=t,this.previous=e,this.next=i,this.container=n}function n(t){this.length=0,this.first=null,this.last=null,this.cmpFunc=t}(e.exports=n).prototype.add=function(t){var e=new r(t,null,null,this);if(this.length+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var n,o=this.cmpFunc(t,this.last.object);if(0<=o)return e.previous=this.last,this.last.next=e,this.last=e;if(i+o<0){for(n=this.first.next;0<=this.cmpFunc(t,n.object);)n=n.next;e.next=n,e.previous=n.previous,e.previous.next=e,n.previous=e}else{for(n=this.last.previous;this.cmpFunc(t,n.object)<0;)n=n.previous;e.previous=n,e.next=n.next,e.next.previous=e,n.next=e}return e},n.prototype.removeByReference=function(t){return t&&t.container===this?(--this.length,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,t.container=null):t},n.prototype.remove=function(t){for(var e=this.first;null!==e;e=e.next)if(e.object===t)return this.removeByReference(e),!0;return!1},n.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},n.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},n.prototype.possess=function(t){return t&&t.container===this},n.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.length;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},n.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.length;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},n.prototype.getFirst=function(){return this.first&&this.first.object},n.prototype.getLast=function(){return this.last&&this.last.object},n.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.length=0,this.first=null,this.last=null},n.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},n.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},n.prototype.findReference=function(t){if(null===this.first)return null;var e;if(this.cmpFunc(t,this.first.object)+this.cmpFunc(t,this.last.object)<0)for(e=this.first;null!==e&&t!==e.object;)e=e.next;else for(e=this.last;null!==e&&t!==e.object;)e=e.previous;return e},n.prototype.reposition=function(t){if(t.container!==this)return console.warn("[SortedList.reposition] Trying to reposition a node that does not belong to the list"),t;var e=t.previous,i=t.next,n=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(n,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(n,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},n.prototype.toArray=function(){for(var t=[],e=this.first;null!==e;e=e.next)t.push(e.object);return t}},{}],48:[function(t,e,i){function n(t,e){this.id=e.getNewWallId(),this.orientation=t,this.start=null,this.end=null,this.dx=0,this.dy=0,this._mapEdge=e}(e.exports=n).prototype.setEnd=function(t,e,i){var n=this._mapEdge.getCorner(t,e,i);((this.end=n).end=this)._computeDirection()},n.prototype.setStart=function(t,e,i){var n=this._mapEdge.getCorner(t,e,i);((this.start=n).start=this)._computeDirection()},n.prototype._computeDirection=function(){this.start&&this.end&&(this.dx=this.end.x-this.start.x,this.dy=this.end.y-this.start.y)}},{}],49:[function(t,e,i){function d(t,e,i,n){this.x=t,this.y=e,this.tr=i,this.ts=n,this.point=null,this.wall=null,this.wallListRef=null}e.exports=function(t,e,i){var n=t.x,o=t.y,r=i.start.x,s=i.start.y,a=i.dx,h=i.dy,u=e.x-n,l=e.y-o;if(0==u&&0==l)return null;var p=a*l-h*u;if(0==p)return null;var c=(u*(s-o)+l*(n-r))/p;return new d(r+a*c,s+h*c,0!=u?(r+a*c-n)/u:(s+h*c-o)/l,c)}},{}],50:[function(t,e,i){var n={UP:0,DOWN:1,LEFT:2,RIGHT:3},o={NW:0,SW:1,SE:2,NE:3},r={},s={s1:n.DOWN,s2:n.LEFT,x:1,y:-1,listId:o.NE},a={s1:n.DOWN,s2:n.RIGHT,x:-1,y:-1,listId:o.NW},h={s1:n.UP,s2:n.LEFT,x:1,y:1,listId:o.SE},u={s1:n.UP,s2:n.RIGHT,x:-1,y:1,listId:o.SW};r[o.NW]=[s,u],r[o.NE]=[a,h],r[o.SW]=[a,h],r[o.SE]=[s,u],i.SEGMENT_ORIENTATION=n,i.POINT_TYPE={CORNER:0,GROOVE:1},i.POINT_ORIENTATION=o,i.CAST_PER_CORNER_ORIENTATION=r},{}],51:[function(t,e,i){var h=t("./RaycastsResult"),r=t("./Corner"),u=t("./Wall"),n=t("./constants"),l=n.SEGMENT_ORIENTATION,p=n.POINT_ORIENTATION;function o(t){this.map=t,this.cornerMap={},this.corners=[],this.walls=[],this.upWalls=[],this._wallId=0,this._prepare()}(e.exports=o).prototype.getNewWallId=function(){return this._wallId++},o.prototype.getCorner=function(t,e,i){var n="p:"+t+":"+e+":"+i,o=this.cornerMap[n];return o=o||(this.cornerMap[n]=new r(t,e,i,n))},o.prototype._hasTile=function(t,e){return t<0||t>=this.map.width||e<0||e>=this.map.height||!!this.map.get(t,e)},o.prototype._prepare=function(){for(var t=this.map,e=null,i=0;i<=t.height;i++){e=null;for(var n=0;n<=t.width;n++){var o=this._hasTile(n,i-1),r=this._hasTile(n,i);if(e)if(e.orientation===l.UP)if(r===o){s=r?p.NW:p.NE;if(e.setStart(n,i,s),this.walls.push(e),this.upWalls.push(e),s===p.NE){a=e.start;this.corners.push(a)}e=null}else o&&!r&&(e.setStart(n,i,p.NW),this.walls.push(e),this.upWalls.push(e),(e=new u(l.DOWN,this)).setStart(n,i,p.SE));else if(e.orientation===l.DOWN)if(r===o){s=r?p.SW:p.SE;if(e.setEnd(n,i,s),this.walls.push(e),s===p.SE){a=e.end;this.corners.push(a)}e=null}else!o&&r&&(e.setEnd(n,i,p.SW),this.walls.push(e),(e=new u(l.UP,this)).setEnd(n,i,p.NE));else console.error("Something went wrong!");else if(r&&!o){var s=this._hasTile(n-1,i)?p.NE:p.NW;if((e=new u(l.UP,this)).setEnd(n,i,s),s===p.NW){var a=e.end;this.corners.push(a)}}else if(!r&&o){var s=this._hasTile(n-1,i)?p.SE:p.SW;if((e=new u(l.DOWN,this)).setStart(n,i,s),s===p.SW){var a=e.start;this.corners.push(a)}}}}for(n=0;n<=t.width;n++)for(e=null,i=0;i<=t.height;i++){o=this._hasTile(n-1,i),r=this._hasTile(n,i);if(e)if(e.orientation===l.LEFT)if(r===o){s=r?p.NW:p.SW;e.setEnd(n,i,s),this.walls.push(e),e=null}else o&&!r&&(e.setEnd(n,i,p.NW),this.walls.push(e),(e=new u(l.RIGHT,this)).setEnd(n,i,p.SE));else if(e.orientation===l.RIGHT)if(r===o){s=r?p.NE:p.SE;e.setStart(n,i,s),this.walls.push(e),e=null}else!o&&r&&(e.setStart(n,i,p.NE),this.walls.push(e),(e=new u(l.LEFT,this)).setStart(n,i,p.SW));else console.error("Something went wrong!");else if(r&&!o){var s=this._hasTile(n,i-1)?p.SW:p.NW;(e=new u(l.LEFT,this)).setStart(n,i,s)}else if(!r&&o){s=this._hasTile(n,i-1)?p.SE:p.NE;(e=new u(l.RIGHT,this)).setEnd(n,i,s)}}for(var h=this.corners.length-1;0<=h;h--){(a=this.corners[h]).initAsCorner(this.walls)}},o.prototype._getPolygonStart=function(t,e){var i=t.wall;if(!i)return null;var n=e.walls[i.id];if(!n)return i.start;for(var o=(t.x-i.start.x)/i.dx,r=i.start,s=n.first;null!==s&&!(s.object.ts>o);s=s.next)r=s.object;return r},o.prototype._getDownwardRaycast=function(t,e){for(var i=0;i<this.upWalls.length;i++){var n=this.upWalls[i];if(!(n.start.y<=e)&&(n.start.x>=t&&n.end.x<=t))return{x:t,y:n.start.y,wall:n}}return null},o.prototype._getAllCornersRaycasts=function(t,e){for(var i={x:t,y:e},n=new h,o=0;o<this.corners.length;o++){var r=this.corners[o],s=r.x<t?r.y<e?p.NW:p.SW:r.y<e?p.NE:p.SE;if(0!==r.cast[s].length){var a=r.projectRaycast(i,s);a&&(a.wallListRef=n.addRaycast(r,a))}}return n},o.prototype.getCastPolygon=function(t,e){var i=this._getDownwardRaycast(t,e);if(!i)return null;var n=this._getAllCornersRaycasts(t,e),o=this._getPolygonStart(i,n);if(!o)return null;var r=[],s=o,a=!0;if(s.wallListRef){if(u=s.wallListRef.next)s=(p=u.object).point,a=!0;else s=s.wall.end,a=!1;o=s}do{r.push(s);var h=n.corners[s.id];if(h&&!a){r.push(h);var u,l=h.wall;if(u=h.wallListRef.next){var p=u.object;r.push(p),s=p.point,a=!0}else s=l.end,a=!1}else{(l=s.start)||console.warn(s);var c=n.walls[l.id];a=c?(p=(u=c.first).object,r.push(p),s=p.point,!0):(s=l.end,!1)}}while(s!==o);return r}},{"./Corner":45,"./RaycastsResult":46,"./Wall":48,"./constants":50}],52:[function(t,e,i){var n=t("./MapEdge"),o=t("pixelbox/Texture"),a=settings.tileSize.width,h=settings.tileSize.height;function r(t,e){var i=$screen.ctx;pen(e||15);for(var n=0;n<t.length;n++){var o=t[n],r=o.start,s=o.end;i.beginPath(),i.moveTo(r.x*a,r.y*h),i.lineTo(s.x*a,s.y*h),i.stroke()}}var s=getMap("map"),u=getMap("background"),l=new n(s);console.log(l);var p=new o(settings.screen.width,settings.screen.height);t("pixelbox/pointer").onMove(function(t,e){if(s.get(~~(t/a),~~(e/h)))return cls(),draw(s),void sprite(128,~~t-4,~~e-4);var i=l.getCastPolygon(t/a+.001,e/h+.001);i&&(cls(),p.clear(),p.ctx.globalCompositeOperation="source-over",function(t,e){var i=(e=e||$screen).ctx;e.paper(1),e.pen(1),i.beginPath(),i.moveTo(t[0].x*a,t[0].y*h);for(var n=1;n<t.length;n++){var o=t[n];i.lineTo(o.x*a,o.y*h)}i.strokeStyle="#FF0",i.closePath(),i.fill(),paper(0)}(i,p),p.draw(assets.halo,t-100,e-100),p.ctx.globalCompositeOperation="destination-in",p.draw(assets.lightMask,t-100,e-100),$screen.clear(),$screen.paper(0),draw(p,0,0),$screen.ctx.globalCompositeOperation="source-in",draw(u),$screen.ctx.globalCompositeOperation="source-over",draw(s),sprite(107,~~t-4,~~e-4))});var c=0;i.update=function(){if(btnp.A){cls(),timer=0,c=++c%l.corners.length,r(l.walls,5);var t=l.corners[c];!function(t,e){for(var i=0;i<t.length;i++){var n=t[i];pen(e||6+n.orientation),rect(n.x*a-1,n.y*h-1,3,3)}}([t]),r(t.cast[0],6),r(t.cast[1],7),r(t.cast[2],8),r(t.cast[3],15)}}},{"./MapEdge":51,"pixelbox/Texture":13,"pixelbox/pointer":20}],53:[function(f,t,e){var i=f("./projectData.json");window.settings=i.settings;var n=f("./assetLoader");window.inherits=f("./inherits"),window.setFullScreen=function(){};var o,r,s=f("tina"),a=(new(window.TINA=s).Ticker).useAsDefault();function h(){o.resume(),document.body.removeEventListener("mousedown",h),document.body.removeEventListener("touchstart",h)}s.add(a),o=null,r=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return o||(o=new r,document.body.addEventListener("mousedown",h),document.body.addEventListener("touchstart",h),o)};var u=f("audio-manager"),l=window.audioManager=new u(["sfx"]);l.settings.audioPath="audio/",l.settings.defaultFade=.3,l.init(),l.setVolume("sfx",1),window.sfx=function(t,e,i,n){l.playSound("sfx",t,e,i,n)},window.music=function(t,e,i,n){t?l.playLoopSound("sfx",t,e,0,0,i,n):l.stopLoopSound("sfx")};var p=window.btn={},c=window.btnp={},d=window.btnr={},v={},_=[],y=0;function g(){for(var t=0;t<y;t++)c[_[t]]=!1,d[_[t]]=!1}function m(t,e){var i=v[t];i&&(e&&!p[i]&&(c[i]=!0),!e&&p[i]&&(d[i]=!0),p[i]=e)}!function(){var t=settings.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)v[t[e]]=e,p[e]=!1,c[e]=!1,d[e]=!1,_.push(e);y=_.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),m(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),m(t.keyCode,!1)}),window.chr$=function(t){return String.fromCharCode(t)},window.clip=function(t,e,i){return Math.max(e,Math.min(i,t))},window.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var b=f("./Texture"),w=f("./TileMap");f("./Texture/canvas2D"),f("./Texture/textCanvas2D"),window.texture=function(t){var e=new b(t.width,t.height);return e.clear().draw(t,0,0),e},window.tilesheet=function(t){return b.prototype.setGlobalTilesheet(t)};var x=function(){var t=settings.screen,h=t.width,u=t.height,l=t.pixelSize,e=window.$screen=new b(h,u),i=e.canvas,n=i.style;if(document.body.appendChild(i),t.fullscreen)if(t.keepAspectRatio){function o(){var t=window.innerWidth,e=window.innerHeight,i=h*l.width,n=u*l.height,o=Math.min(t/i,e/n),r=i*o,s=n*o,a=$screen.canvas.style;a.width=r+"px",a.height=s+"px",a.left=(t-r)/2+"px",a.top=(e-s)/2+"px"}addEventListener("resize",o),o()}else n.width=n.height="100%";else n.width=h*l.width+"px",n.height=u*l.height+"px";return e}();window.cls=function(){return x.cls()},window.sprite=function(t,e,i,n,o,r){return x.sprite(t,e,i,n,o,r)},window.draw=function(t,e,i,n,o,r){return x.draw(t,e,i,n,o,r)},window.rect=function(t,e,i,n){return x.rect(t,e,i,n)},window.rectf=function(t,e,i,n){return x.rectf(t,e,i,n)},window.camera=function(t,e){return x.setCamera(t,e)},window.pen=function(t){return x.pen(t)},window.paper=function(t){return x.paper(t)},window.locate=function(t,e){return x.locate(t,e)},window.print=function(t,e,i){return x.print(t,e,i)},window.println=function(t){return x.println(t)},window.getMap=w.getMap,window.rectfill=window.rectf;var T=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var S=~~(settings.screen.width/2),P=~~(settings.screen.width/4),R=~~(settings.screen.height/2);var j=["#000","#FFF"],M=settings.loader&&settings.loader.colors||settings.loaderColors||j;Array.isArray(M)||(M=j);var I=f("./ColorRGB");x.setPalette([(new I).fromString(M[0]),(new I).fromString(M[1])]),paper(0),cls(),paper(1),pen(1),rect(S-P-2,R-4,2*P+4,8),n.preloadStaticAssets(i,function(t,d){if(paper(0).pen(1).cls(),t)return console.error(t),void print(t);window.assets=d,function(){var t=f("./ColorRGB"),e=settings.palette;if(e.file){for(var i=e.file.split("/"),n=d;n&&i.length;)n=n[i.shift()];if(!n)return;var o=n.width,r=n.height,s=n.x||0,a=n.y||0;n._isSprite&&(n=n.img);var h=f("./domUtils/createCanvas")(o,r).getContext("2d");h.drawImage(n,s,a,o,r,0,0,o,r);for(var u=h.getImageData(0,0,o,r).data,l=[],p=0;p<u.length;p+=4)u[p+3]<=1||l.push((new t).fromPixel(u,p));x.setPalette(l)}else{var c;for(c=e.colors?e.colors:e,l=[],p=0;p<c.length;p++)l.push((new t).fromString(c[p]));x.setPalette(l)}}(),d.tilesheet&&tilesheet(d.tilesheet),w.loadBank(d.maps);var e=f("./gamepad"),i=settings.gamepad||{};i.analogToDpad&&e.mapAnalogStickToDpad(i.deadZone);var n=f("../../src/main.js");n.update&&(g(),function t(){window.frameId+=1,s.update(),e.update(),n.update(),g(),T(t)}())},function(t,e,i,n){rect(S-P-2,R-4,2*P+4,8),rectf(S-P,R-2,~~(n*P*2),4)})},{"../../src/main.js":52,"./ColorRGB":11,"./Texture":13,"./Texture/canvas2D":12,"./Texture/textCanvas2D":14,"./TileMap":15,"./assetLoader":16,"./domUtils/createCanvas":17,"./gamepad":18,"./inherits":19,"./projectData.json":21,"audio-manager":5,tina:42}]},{},[53]);